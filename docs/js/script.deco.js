!function b(u,t,c){function h(bb,ub){if(!t[bb]){if(!u[bb]){var tb="function"==typeof require&&require;if(!ub&&tb)return tb(bb,!0);if(i)return i(bb,!0);var cb=new Error("Cannot find module '"+bb+"'");throw cb.code="MODULE_NOT_FOUND",cb}var hb=t[bb]={exports:{}};u[bb][0].call(hb.exports,function(b){var t=u[bb][1][b];return h(t?t:b)},hb,hb.exports,b,u,t,c)}return t[bb].exports}for(var i="function"==typeof require&&require,bb=0;bb<c.length;bb++)h(c[bb]);return h}({1:[function(b,u,t){!function(b,t){"function"==typeof define&&define.amd?define(function(){return t()}):"object"==typeof u?u.exports=t():b.Tone=t()}(this,function(){"use strict";function b(b){t=b()}function u(b){b(t)}var t;/**
	 *  Tone.js
	 *  @author Yotam Mann
	 *  @license http://opensource.org/licenses/MIT MIT License
	 *  @copyright 2014-2017 Yotam Mann
	 */
return b(function(){var b=function(b,u){this.isUndef(b)||1===b?this.input=this.context.createGain():b>1&&(this.input=new Array(b)),this.isUndef(u)||1===u?this.output=this.context.createGain():u>1&&(this.output=new Array(b))};b.prototype.set=function(u,t,c){if(this.isObject(u))c=t;else if(this.isString(u)){var h={};h[u]=t,u=h}b:for(var i in u){t=u[i];var bb=this;if(-1!==i.indexOf(".")){for(var ub=i.split("."),tb=0;tb<ub.length-1;tb++)if(bb=bb[ub[tb]],bb instanceof b){ub.splice(0,tb+1);var cb=ub.join(".");bb.set(cb,t);continue b}i=ub[ub.length-1]}var hb=bb[i];this.isUndef(hb)||(b.Signal&&hb instanceof b.Signal||b.Param&&hb instanceof b.Param?hb.value!==t&&(this.isUndef(c)?hb.value=t:hb.rampTo(t,c)):hb instanceof AudioParam?hb.value!==t&&(hb.value=t):hb instanceof b?hb.set(t):hb!==t&&(bb[i]=t))}return this},b.prototype.get=function(u){this.isUndef(u)?u=this._collectDefaults(this.constructor):this.isString(u)&&(u=[u]);for(var t={},c=0;c<u.length;c++){var h=u[c],i=this,bb=t;if(-1!==h.indexOf(".")){for(var ub=h.split("."),tb=0;tb<ub.length-1;tb++){var cb=ub[tb];bb[cb]=bb[cb]||{},bb=bb[cb],i=i[cb]}h=ub[ub.length-1]}var hb=i[h];this.isObject(u[h])?bb[h]=hb.get():b.Signal&&hb instanceof b.Signal?bb[h]=hb.value:b.Param&&hb instanceof b.Param?bb[h]=hb.value:hb instanceof AudioParam?bb[h]=hb.value:hb instanceof b?bb[h]=hb.get():this.isFunction(hb)||this.isUndef(hb)||(bb[h]=hb)}return t},b.prototype._collectDefaults=function(b){var u=[];if(this.isUndef(b.defaults)||(u=Object.keys(b.defaults)),!this.isUndef(b._super))for(var t=this._collectDefaults(b._super),c=0;c<t.length;c++)-1===u.indexOf(t[c])&&u.push(t[c]);return u},b.prototype.toString=function(){for(var u in b){var t=u[0].match(/^[A-Z]$/),c=b[u]===this.constructor;if(this.isFunction(b[u])&&t&&c)return u}return"Tone"},Object.defineProperty(b.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(b.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),b.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},b.prototype.connect=function(b,u,t){return Array.isArray(this.output)?(u=this.defaultArg(u,0),this.output[u].connect(b,0,t)):this.output.connect(b,u,t),this},b.prototype.disconnect=function(b,u,t){this.isArray(this.output)?this.isNumber(b)?this.output[b].disconnect():(u=this.defaultArg(u,0),this.output[u].disconnect(b,0,t)):this.output.disconnect.apply(this.output,arguments)},b.prototype.connectSeries=function(){if(arguments.length>1)for(var b=arguments[0],u=1;u<arguments.length;u++){var t=arguments[u];b.connect(t),b=t}return this},b.prototype.chain=function(){if(arguments.length>0)for(var b=this,u=0;u<arguments.length;u++){var t=arguments[u];b.connect(t),b=t}return this},b.prototype.fan=function(){if(arguments.length>0)for(var b=0;b<arguments.length;b++)this.connect(arguments[b]);return this},AudioNode.prototype.chain=b.prototype.chain,AudioNode.prototype.fan=b.prototype.fan,b.prototype.defaultArg=function(b,u){if(this.isObject(b)&&this.isObject(u)){var t={};for(var c in b)t[c]=this.defaultArg(u[c],b[c]);for(var h in u)t[h]=this.defaultArg(b[h],u[h]);return t}return this.isUndef(b)?u:b},b.prototype.optionsObject=function(b,u,t){var c={};if(1===b.length&&this.isObject(b[0]))c=b[0];else for(var h=0;h<u.length;h++)c[u[h]]=b[h];return this.isUndef(t)?c:this.defaultArg(c,t)},b.prototype.isUndef=function(b){return"undefined"==typeof b},b.prototype.isFunction=function(b){return"function"==typeof b},b.prototype.isNumber=function(b){return"number"==typeof b},b.prototype.isObject=function(b){return"[object Object]"===Object.prototype.toString.call(b)&&b.constructor===Object},b.prototype.isBoolean=function(b){return"boolean"==typeof b},b.prototype.isArray=function(b){return Array.isArray(b)},b.prototype.isString=function(b){return"string"==typeof b},b.noOp=function(){},b.prototype._readOnly=function(b){if(Array.isArray(b))for(var u=0;u<b.length;u++)this._readOnly(b[u]);else Object.defineProperty(this,b,{writable:!1,enumerable:!0})},b.prototype._writable=function(b){if(Array.isArray(b))for(var u=0;u<b.length;u++)this._writable(b[u]);else Object.defineProperty(this,b,{writable:!0})},b.State={Started:"started",Stopped:"stopped",Paused:"paused"},b.prototype.equalPowerScale=function(b){var u=.5*Math.PI;return Math.sin(b*u)},b.prototype.dbToGain=function(b){return Math.pow(2,b/6)},b.prototype.gainToDb=function(b){return 20*(Math.log(b)/Math.LN10)},b.prototype.intervalToFrequencyRatio=function(b){return Math.pow(2,b/12)},b.prototype.now=function(){return b.context.now()},b.now=function(){return b.context.now()},b.extend=function(u,t){function c(){}b.prototype.isUndef(t)&&(t=b),c.prototype=t.prototype,u.prototype=new c,u.prototype.constructor=u,u._super=t};var u;return Object.defineProperty(b,"context",{get:function(){return u},set:function(t){u=b.Context&&t instanceof b.Context?t:new b.Context(t),b.Context&&b.Context.emit("init",u)}}),Object.defineProperty(b.prototype,"context",{get:function(){return b.context}}),b.setContext=function(u){b.context=u},Object.defineProperty(b.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(b.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(b,"supported",{get:function(){var b=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),u=window.hasOwnProperty("Promise"),t=window.hasOwnProperty("Worker");return b&&u&&t}}),b.version="r10",window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+b.version+" * ","background: #000; color: #fff"),b}),u(function(b){return b.SignalBase=function(){},b.extend(b.SignalBase),b.SignalBase.prototype.connect=function(u,t,c){return b.Signal&&b.Signal===u.constructor||b.Param&&b.Param===u.constructor||b.TimelineSignal&&b.TimelineSignal===u.constructor?(u._param.cancelScheduledValues(0),u._param.value=0,u.overridden=!0):u instanceof AudioParam&&(u.cancelScheduledValues(0),u.value=0),b.prototype.connect.call(this,u,t,c),this},b.SignalBase}),u(function(b){return b.WaveShaper=function(b,u){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(b)?this.curve=b:isFinite(b)||this.isUndef(b)?this._curve=new Float32Array(this.defaultArg(b,1024)):this.isFunction(b)&&(this._curve=new Float32Array(this.defaultArg(u,1024)),this.setMap(b))},b.extend(b.WaveShaper,b.SignalBase),b.WaveShaper.prototype.setMap=function(b){for(var u=0,t=this._curve.length;t>u;u++){var c=u/(t-1)*2-1;this._curve[u]=b(c,u)}return this._shaper.curve=this._curve,this},Object.defineProperty(b.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(b){this._curve=new Float32Array(b),this._shaper.curve=this._curve}}),Object.defineProperty(b.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(b){if(-1===["none","2x","4x"].indexOf(b))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=b}}),b.WaveShaper.prototype.dispose=function(){return b.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},b.WaveShaper}),u(function(b){/**
		 *  @class Tone.TimeBase is a flexible encoding of time
		 *         which can be evaluated to and from a string.
		 *         Parsing code modified from https://code.google.com/p/tapdigit/
		 *         Copyright 2011 2012 Ariya Hidayat, New BSD License
		 *  @extends {Tone}
		 *  @param  {Time}  val    The time value as a number or string
		 *  @param  {String=}  units  Unit values
		 *  @example
		 * Tone.TimeBase(4, "n")
		 * Tone.TimeBase(2, "t")
		 * Tone.TimeBase("2t").add("1m")
		 * Tone.TimeBase("2t + 1m");
		 */
return b.TimeBase=function(u,t){if(!(this instanceof b.TimeBase))return new b.TimeBase(u,t);if(this._expr=this._noOp,u instanceof b.TimeBase)this.copy(u);else if(!this.isUndef(t)||this.isNumber(u)){t=this.defaultArg(t,this._defaultUnits);var c=this._primaryExpressions[t].method;this._expr=c.bind(this,u)}else this.isString(u)?this.set(u):this.isUndef(u)&&(this._expr=this._defaultExpr())},b.extend(b.TimeBase),b.TimeBase.prototype.set=function(b){return this._expr=this._parseExprString(b),this},b.TimeBase.prototype.clone=function(){var b=new this.constructor;return b.copy(this),b},b.TimeBase.prototype.copy=function(b){var u=b._expr();return this.set(u)},b.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(b){return b=parseInt(b),1===b?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/b)}},t:{regexp:/^(\d+)t/i,method:function(b){return b=parseInt(b),this._beatsToUnits(8/(3*parseInt(b)))}},m:{regexp:/^(\d+)m/i,method:function(b){return this._beatsToUnits(parseInt(b)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(b){return this._ticksToUnits(parseInt(b))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(b){return this._frequencyToUnits(parseFloat(b))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(b,u,t){var c=0;return b&&"0"!==b&&(c+=this._beatsToUnits(this._timeSignature()*parseFloat(b))),u&&"0"!==u&&(c+=this._beatsToUnits(parseFloat(u))),t&&"0"!==t&&(c+=this._beatsToUnits(parseFloat(t)/4)),c}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(b){return this._secondsToUnits(parseFloat(b))}},samples:{regexp:/^(\d+)samples/,method:function(b){return parseInt(b)/this.context.sampleRate}},"default":{regexp:/^(\d+(?:\.\d+)?)/,method:function(b){return this._primaryExpressions[this._defaultUnits].method.call(this,b)}}},b.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(b,u){return b()+u()}},"-":{regexp:/^\-/,precedence:2,method:function(b,u){return b()-u()}},"*":{regexp:/^\*/,precedence:1,method:function(b,u){return b()*u()}},"/":{regexp:/^\//,precedence:1,method:function(b,u){return b()/u()}}},b.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(b){return-b()}}},b.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},b.TimeBase.prototype._tokenize=function(b){function u(b,u){for(var t=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],c=0;c<t.length;c++){var h=u[t[c]];for(var i in h){var bb=h[i],ub=bb.regexp,tb=b.match(ub);if(null!==tb)return{method:bb.method,precedence:bb.precedence,regexp:bb.regexp,value:tb[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+b)}for(var t=-1,c=[];b.length>0;){b=b.trim();var h=u(b,this);c.push(h),b=b.substr(h.value.length)}return{next:function(){return c[++t]},peek:function(){return c[t+1]}}},b.TimeBase.prototype._matchGroup=function(b,u,t){var c=!1;if(!this.isUndef(b))for(var h in u){var i=u[h];if(i.regexp.test(b.value)){if(this.isUndef(t))return i;if(i.precedence===t)return i}}return c},b.TimeBase.prototype._parseBinary=function(b,u){this.isUndef(u)&&(u=2);var t;t=0>u?this._parseUnary(b):this._parseBinary(b,u-1);for(var c=b.peek();c&&this._matchGroup(c,this._binaryExpressions,u);)c=b.next(),t=c.method.bind(this,t,this._parseBinary(b,u-1)),c=b.peek();return t},b.TimeBase.prototype._parseUnary=function(b){var u,t;u=b.peek();var c=this._matchGroup(u,this._unaryExpressions);return c?(u=b.next(),t=this._parseUnary(b),c.method.bind(this,t)):this._parsePrimary(b)},b.TimeBase.prototype._parsePrimary=function(b){var u,t;if(u=b.peek(),this.isUndef(u))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(u,this._primaryExpressions)){u=b.next();var c=u.value.match(u.regexp);return u.method.bind(this,c[1],c[2],c[3])}if(u&&"("===u.value){if(b.next(),t=this._parseBinary(b),u=b.next(),!u||")"!==u.value)throw new SyntaxError("Expected )");return t}throw new SyntaxError("Tone.TimeBase: Cannot process token "+u.value)},b.TimeBase.prototype._parseExprString=function(b){this.isString(b)||(b=b.toString());var u=this._tokenize(b),t=this._parseBinary(u);return t},b.TimeBase.prototype._noOp=function(){return 0},b.TimeBase.prototype._defaultExpr=function(){return this._noOp},b.TimeBase.prototype._defaultUnits="s",b.TimeBase.prototype._frequencyToUnits=function(b){return 1/b},b.TimeBase.prototype._beatsToUnits=function(u){return 60/b.Transport.bpm.value*u},b.TimeBase.prototype._secondsToUnits=function(b){return b},b.TimeBase.prototype._ticksToUnits=function(u){return u*(this._beatsToUnits(1)/b.Transport.PPQ)},b.TimeBase.prototype._timeSignature=function(){return b.Transport.timeSignature},b.TimeBase.prototype._pushExpr=function(u,t,c){return u instanceof b.TimeBase||(u=new this.constructor(u,c)),this._expr=this._binaryExpressions[t].method.bind(this,this._expr,u._expr),this},b.TimeBase.prototype.add=function(b,u){return this._pushExpr(b,"+",u)},b.TimeBase.prototype.sub=function(b,u){return this._pushExpr(b,"-",u)},b.TimeBase.prototype.mult=function(b,u){return this._pushExpr(b,"*",u)},b.TimeBase.prototype.div=function(b,u){return this._pushExpr(b,"/",u)},b.TimeBase.prototype.valueOf=function(){return this._expr()},b.TimeBase.prototype.dispose=function(){this._expr=null},b.TimeBase}),u(function(b){return b.Time=function(u,t){return this instanceof b.Time?(this._plusNow=!1,void b.TimeBase.call(this,u,t)):new b.Time(u,t)},b.extend(b.Time,b.TimeBase),b.Time.prototype._unaryExpressions=Object.create(b.TimeBase.prototype._unaryExpressions),b.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(u){return b.Transport.nextSubdivision(u())}},b.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(b){return this._plusNow=!0,b()}},b.Time.prototype.quantize=function(b,u){return u=this.defaultArg(u,1),this._expr=function(b,u,t){b=b(),u=u.toSeconds();var c=Math.round(b/u),h=c*u,i=h-b;return b+i*t}.bind(this,this._expr,new this.constructor(b),u),this},b.Time.prototype.addNow=function(){return this._plusNow=!0,this},b.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},b.Time.prototype.copy=function(u){return b.TimeBase.prototype.copy.call(this,u),this._plusNow=u._plusNow,this},b.Time.prototype.toNotation=function(){var b=this.toSeconds(),u=["1m","2n","4n","8n","16n","32n","64n","128n"],t=this._toNotationHelper(b,u),c=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],h=this._toNotationHelper(b,c);return h.split("+").length<t.split("+").length?h:t},b.Time.prototype._toNotationHelper=function(b,u){for(var t=this._notationToUnits(u[u.length-1]),c="",h=0;h<u.length;h++){var i=this._notationToUnits(u[h]),bb=b/i,ub=1e-6;if(ub>1-bb%1&&(bb+=ub),bb=Math.floor(bb),bb>0){if(c+=1===bb?u[h]:bb.toString()+"*"+u[h],b-=bb*i,t>b)break;c+=" + "}}return""===c&&(c="0"),c},b.Time.prototype._notationToUnits=function(b){for(var u=this._primaryExpressions,t=[u.n,u.t,u.m],c=0;c<t.length;c++){var h=t[c],i=b.match(h.regexp);if(i)return h.method.call(this,i[1])}},b.Time.prototype.toBarsBeatsSixteenths=function(){var b=this._beatsToUnits(1),u=this.toSeconds()/b,t=Math.floor(u/this._timeSignature()),c=u%1*4;u=Math.floor(u)%this._timeSignature(),c=c.toString(),c.length>3&&(c=parseFloat(c).toFixed(3));var h=[t,u,c];return h.join(":")},b.Time.prototype.toTicks=function(){var u=this._beatsToUnits(1),t=this.valueOf()/u;return Math.floor(t*b.Transport.PPQ)},b.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},b.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},b.Time.prototype.toSeconds=function(){return this.valueOf()},b.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},b.Time.prototype.valueOf=function(){var b=this._expr();return b+(this._plusNow?this.now():0)},b.Time}),u(function(b){b.Frequency=function(u,t){return this instanceof b.Frequency?void b.TimeBase.call(this,u,t):new b.Frequency(u,t)},b.extend(b.Frequency,b.TimeBase),b.Frequency.prototype._primaryExpressions=Object.create(b.TimeBase.prototype._primaryExpressions),b.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(b){return this.midiToFrequency(b)}},b.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(b,t){var c=u[b.toLowerCase()],h=c+12*(parseInt(t)+1);return this.midiToFrequency(h)}},b.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(b,u,t){var c=1;return b&&"0"!==b&&(c*=this._beatsToUnits(this._timeSignature()*parseFloat(b))),u&&"0"!==u&&(c*=this._beatsToUnits(parseFloat(u))),t&&"0"!==t&&(c*=this._beatsToUnits(parseFloat(t)/4)),c}},b.Frequency.prototype.transpose=function(b){return this._expr=function(b,u){var t=b();return t*this.intervalToFrequencyRatio(u)}.bind(this,this._expr,b),this},b.Frequency.prototype.harmonize=function(b){return this._expr=function(b,u){for(var t=b(),c=[],h=0;h<u.length;h++)c[h]=t*this.intervalToFrequencyRatio(u[h]);return c}.bind(this,this._expr,b),this},b.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},b.Frequency.prototype.toNote=function(){var u=this.valueOf(),c=Math.log(u/b.Frequency.A4)/Math.LN2,h=Math.round(12*c)+57,i=Math.floor(h/12);0>i&&(h+=-12*i);var bb=t[h%12];return bb+i.toString()},b.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},b.Frequency.prototype.toFrequency=function(){return this.valueOf()},b.Frequency.prototype.toTicks=function(){var u=this._beatsToUnits(1),t=this.valueOf()/u;return Math.floor(t*b.Transport.PPQ)},b.Frequency.prototype._frequencyToUnits=function(b){return b},b.Frequency.prototype._ticksToUnits=function(u){return 1/(60*u/(b.Transport.bpm.value*b.Transport.PPQ))},b.Frequency.prototype._beatsToUnits=function(u){return 1/b.TimeBase.prototype._beatsToUnits.call(this,u)},b.Frequency.prototype._secondsToUnits=function(b){return 1/b},b.Frequency.prototype._defaultUnits="hz";var u={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return b.Frequency.A4=440,b.Frequency.prototype.midiToFrequency=function(u){return b.Frequency.A4*Math.pow(2,(u-69)/12)},b.Frequency.prototype.frequencyToMidi=function(u){return 69+12*Math.log(u/b.Frequency.A4)/Math.LN2},b.Frequency}),u(function(b){return b.TransportTime=function(u,t){return this instanceof b.TransportTime?void b.Time.call(this,u,t):new b.TransportTime(u,t)},b.extend(b.TransportTime,b.Time),b.TransportTime.prototype._unaryExpressions=Object.create(b.Time.prototype._unaryExpressions),b.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(u){var t=this._secondsToTicks(u()),c=Math.ceil(b.Transport.ticks/t);return this._ticksToUnits(c*t)}},b.TransportTime.prototype._secondsToTicks=function(u){var t=this._beatsToUnits(1),c=u/t;return Math.round(c*b.Transport.PPQ)},b.TransportTime.prototype.valueOf=function(){var u=this._secondsToTicks(this._expr());return u+(this._plusNow?b.Transport.ticks:0)},b.TransportTime.prototype.toTicks=function(){return this.valueOf()},b.TransportTime.prototype.toSeconds=function(){var u=this._expr();return u+(this._plusNow?b.Transport.seconds:0)},b.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},b.TransportTime}),u(function(b){/**
		 *  @class Tone.Emitter gives classes which extend it
		 *         the ability to listen for and emit events. 
		 *         Inspiration and reference from Jerome Etienne's [MicroEvent](https://github.com/jeromeetienne/microevent.js).
		 *         MIT (c) 2011 Jerome Etienne.
		 *         
		 *  @extends {Tone}
		 */
return b.Emitter=function(){this._events={}},b.extend(b.Emitter),b.Emitter.prototype.on=function(b,u){for(var t=b.split(/\W+/),c=0;c<t.length;c++){var h=t[c];this._events.hasOwnProperty(h)||(this._events[h]=[]),this._events[h].push(u)}return this},b.Emitter.prototype.off=function(u,t){for(var c=u.split(/\W+/),h=0;h<c.length;h++)if(u=c[h],this._events.hasOwnProperty(u))if(b.prototype.isUndef(t))this._events[u]=[];else for(var i=this._events[u],bb=0;bb<i.length;bb++)i[bb]===t&&i.splice(bb,1);return this},b.Emitter.prototype.emit=function(b){if(this._events){var u=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(b))for(var t=this._events[b],c=0,h=t.length;h>c;c++)t[c].apply(this,u)}return this},b.Emitter.mixin=function(u){var t=["on","off","emit"];u._events={};for(var c=0;c<t.length;c++){var h=t[c],i=b.Emitter.prototype[h];u[h]=i}},b.Emitter.prototype.dispose=function(){return b.prototype.dispose.call(this),this._events=null,this},b.Emitter}),u(function(b){function u(){function u(u,t,h){if(u.input)Array.isArray(u.input)?(b.prototype.isUndef(h)&&(h=0),this.connect(u.input[h])):this.connect(u.input,t,h);else try{u instanceof AudioNode?c.call(this,u,t,h):c.call(this,u,t)}catch(i){throw new Error("error connecting to node: "+u+"\n"+i)}}function t(u,t,c){if(u&&u.input&&Array.isArray(u.input))b.prototype.isUndef(c)&&(c=0),this.disconnect(u.input[c],t,c);else if(u&&u.input)this.disconnect(u.input,t,c);else try{h.apply(this,arguments)}catch(i){throw new Error("error disconnecting node: "+u+"\n"+i)}}var c=AudioNode.prototype.connect,h=AudioNode.prototype.disconnect;AudioNode.prototype.connect!==u&&(AudioNode.prototype.connect=u,AudioNode.prototype.disconnect=t)}return!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),b.Context=function(u){b.Emitter.call(this),u||(u=new window.AudioContext),this._context=u;for(var t in this._context)this._defineProperty(this._context,t);this._latencyHint="interactive",this._lookAhead=.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},b.extend(b.Context,b.Emitter),b.Emitter.mixin(b.Context),b.Context.prototype._defineProperty=function(b,u){this.isUndef(this[u])&&Object.defineProperty(this,u,{get:function(){return"function"==typeof b[u]?b[u].bind(b):b[u]},set:function(t){b[u]=t}})},b.Context.prototype.now=function(){return this._context.currentTime},b.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var b=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){	timeoutTime = parseInt(msg.data);};function tick(){	setTimeout(tick, timeoutTime);	self.postMessage('tick');}tick();"]),u=URL.createObjectURL(b),t=new Worker(u);return t.addEventListener("message",function(){this.emit("tick")}.bind(this)),t.addEventListener("message",function(){var b=this.now();if(this.isNumber(this._lastUpdate)){var u=b-this._lastUpdate;this._computedUpdateInterval=Math.max(u,.97*this._computedUpdateInterval)}this._lastUpdate=b}.bind(this)),t},b.Context.prototype.getConstant=function(b){if(this._constants[b])return this._constants[b];for(var u=this._context.createBuffer(1,128,this._context.sampleRate),t=u.getChannelData(0),c=0;c<t.length;c++)t[c]=b;var h=this._context.createBufferSource();return h.channelCount=1,h.channelCountMode="explicit",h.buffer=u,h.loop=!0,h.start(0),this._constants[b]=h,h},Object.defineProperty(b.Context.prototype,"lag",{get:function(){var b=this._computedUpdateInterval-this._updateInterval;return b=Math.max(b,0)}}),Object.defineProperty(b.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(b){this._lookAhead=b}}),Object.defineProperty(b.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(u){this._updateInterval=Math.max(u,b.prototype.blockTime),this._worker.postMessage(Math.max(1e3*u,1))}}),Object.defineProperty(b.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(b){var u=b;if(this._latencyHint=b,this.isString(b))switch(b){case"interactive":u=.1,this._context.latencyHint=b;break;case"playback":u=.8,this._context.latencyHint=b;break;case"balanced":u=.25,this._context.latencyHint=b;break;case"fastest":u=.01}this.lookAhead=u,this.updateInterval=u/3}}),b.supported?(u(),b.context=new b.Context):console.warn("This browser does not support Tone.js"),b.Context}),u(function(b){return b.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},b.prototype.toSeconds=function(u){return this.isNumber(u)?u:this.isUndef(u)?this.now():this.isString(u)?new b.Time(u).toSeconds():u instanceof b.TimeBase?u.toSeconds():void 0},b.prototype.toFrequency=function(u){return this.isNumber(u)?u:this.isString(u)||this.isUndef(u)?new b.Frequency(u).valueOf():u instanceof b.TimeBase?u.toFrequency():void 0},b.prototype.toTicks=function(u){return this.isNumber(u)||this.isString(u)?new b.TransportTime(u).toTicks():this.isUndef(u)?b.Transport.ticks:u instanceof b.TimeBase?u.toTicks():void 0},b}),u(function(b){return b.Param=function(){var u=this.optionsObject(arguments,["param","units","convert"],b.Param.defaults);this._param=this.input=u.param,this.units=u.units,this.convert=u.convert,this.overridden=!1,this._lfo=null,this.isObject(u.lfo)?this.value=u.lfo:this.isUndef(u.value)||(this.value=u.value)},b.extend(b.Param),b.Param.defaults={units:b.Type.Default,convert:!0,param:void 0},Object.defineProperty(b.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(u){if(this.isObject(u)){if(this.isUndef(b.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new b.LFO(u).start(),this._lfo.connect(this.input)}else{var t=this._fromUnits(u);this._param.cancelScheduledValues(0),this._param.value=t}}}),b.Param.prototype._fromUnits=function(u){if(!this.convert&&!this.isUndef(this.convert))return u;switch(this.units){case b.Type.Time:return this.toSeconds(u);case b.Type.Frequency:return this.toFrequency(u);case b.Type.Decibels:return this.dbToGain(u);case b.Type.NormalRange:return Math.min(Math.max(u,0),1);case b.Type.AudioRange:return Math.min(Math.max(u,-1),1);case b.Type.Positive:return Math.max(u,0);default:return u}},b.Param.prototype._toUnits=function(u){if(!this.convert&&!this.isUndef(this.convert))return u;switch(this.units){case b.Type.Decibels:return this.gainToDb(u);default:return u}},b.Param.prototype._minOutput=1e-5,b.Param.prototype.setValueAtTime=function(b,u){return b=this._fromUnits(b),u=this.toSeconds(u),u<=this.now()+this.blockTime?this._param.value=b:this._param.setValueAtTime(b,u),this},b.Param.prototype.setRampPoint=function(b){b=this.defaultArg(b,this.now());var u=this._param.value;return 0===u&&(u=this._minOutput),this._param.setValueAtTime(u,b),this},b.Param.prototype.linearRampToValueAtTime=function(b,u){return b=this._fromUnits(b),this._param.linearRampToValueAtTime(b,this.toSeconds(u)),this},b.Param.prototype.exponentialRampToValueAtTime=function(b,u){return b=this._fromUnits(b),b=Math.max(this._minOutput,b),this._param.exponentialRampToValueAtTime(b,this.toSeconds(u)),this},b.Param.prototype.exponentialRampToValue=function(b,u,t){return t=this.toSeconds(t),this.setRampPoint(t),this.exponentialRampToValueAtTime(b,t+this.toSeconds(u)),this},b.Param.prototype.linearRampToValue=function(b,u,t){return t=this.toSeconds(t),this.setRampPoint(t),this.linearRampToValueAtTime(b,t+this.toSeconds(u)),this},b.Param.prototype.setTargetAtTime=function(b,u,t){return b=this._fromUnits(b),b=Math.max(this._minOutput,b),t=Math.max(this._minOutput,t),this._param.setTargetAtTime(b,this.toSeconds(u),t),this},b.Param.prototype.setValueCurveAtTime=function(b,u,t){for(var c=0;c<b.length;c++)b[c]=this._fromUnits(b[c]);return this._param.setValueCurveAtTime(b,this.toSeconds(u),this.toSeconds(t)),this},b.Param.prototype.cancelScheduledValues=function(b){return this._param.cancelScheduledValues(this.toSeconds(b)),this},b.Param.prototype.rampTo=function(u,t,c){return t=this.defaultArg(t,0),this.units===b.Type.Frequency||this.units===b.Type.BPM||this.units===b.Type.Decibels?this.exponentialRampToValue(u,t,c):this.linearRampToValue(u,t,c),this},Object.defineProperty(b.Param.prototype,"lfo",{get:function(){return this._lfo}}),b.Param.prototype.dispose=function(){return b.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},b.Param}),u(function(b){return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),b.Gain=function(){var u=this.optionsObject(arguments,["gain","units"],b.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new b.Param({param:this._gainNode.gain,units:u.units,value:u.gain,convert:u.convert}),this._readOnly("gain")},b.extend(b.Gain),b.Gain.defaults={gain:1,convert:!0},b.Gain.prototype.dispose=function(){b.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},b.prototype.createInsOuts=function(u,t){1===u?this.input=new b.Gain:u>1&&(this.input=new Array(u)),1===t?this.output=new b.Gain:t>1&&(this.output=new Array(u))},b.Gain}),u(function(b){return b.Signal=function(){var u=this.optionsObject(arguments,["value","units"],b.Signal.defaults);this.output=this._gain=this.context.createGain(),u.param=this._gain.gain,b.Param.call(this,u),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},b.extend(b.Signal,b.Param),b.Signal.defaults={value:0,units:b.Type.Default,convert:!0},b.Signal.prototype.connect=b.SignalBase.prototype.connect,b.Signal.prototype.dispose=function(){return b.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},b.Signal}),u(function(b){return b.Timeline=function(){var u=this.optionsObject(arguments,["memory"],b.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=u.memory},b.extend(b.Timeline),b.Timeline.defaults={memory:1/0},Object.defineProperty(b.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),b.Timeline.prototype.add=function(b){if(this.isUndef(b.time))throw new Error("Tone.Timeline: events must have a time attribute");if(this._timeline.length){var u=this._search(b.time);this._timeline.splice(u+1,0,b)}else this._timeline.push(b);if(this.length>this.memory){var t=this.length-this.memory;this._timeline.splice(0,t)}return this},b.Timeline.prototype.remove=function(b){if(this._iterating)this._toRemove.push(b);else{var u=this._timeline.indexOf(b);-1!==u&&this._timeline.splice(u,1)}return this},b.Timeline.prototype.get=function(b){var u=this._search(b);return-1!==u?this._timeline[u]:null},b.Timeline.prototype.peek=function(){return this._timeline[0]},b.Timeline.prototype.shift=function(){return this._timeline.shift()},b.Timeline.prototype.getAfter=function(b){var u=this._search(b);return u+1<this._timeline.length?this._timeline[u+1]:null},b.Timeline.prototype.getBefore=function(b){var u=this._timeline.length;if(u>0&&this._timeline[u-1].time<b)return this._timeline[u-1];var t=this._search(b);return t-1>=0?this._timeline[t-1]:null},b.Timeline.prototype.cancel=function(b){if(this._timeline.length>1){var u=this._search(b);if(u>=0)if(this._timeline[u].time===b){for(var t=u;t>=0&&this._timeline[t].time===b;t--)u=t;this._timeline=this._timeline.slice(0,u)}else this._timeline=this._timeline.slice(0,u+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=b&&(this._timeline=[]);return this},b.Timeline.prototype.cancelBefore=function(b){if(this._timeline.length){var u=this._search(b);u>=0&&(this._timeline=this._timeline.slice(u+1))}return this},b.Timeline.prototype._search=function(b){var u=0,t=this._timeline.length,c=t;if(t>0&&this._timeline[t-1].time<=b)return t-1;for(;c>u;){var h=Math.floor(u+(c-u)/2),i=this._timeline[h],bb=this._timeline[h+1];if(i.time===b){for(var ub=h;ub<this._timeline.length;ub++){var tb=this._timeline[ub];tb.time===b&&(h=ub)}return h}if(i.time<b&&bb.time>b)return h;i.time>b?c=h:i.time<b&&(u=h+1)}return-1},b.Timeline.prototype._iterate=function(b,u,t){this._iterating=!0,u=this.defaultArg(u,0),t=this.defaultArg(t,this._timeline.length-1);for(var c=u;t>=c;c++)b(this._timeline[c]);if(this._iterating=!1,this._toRemove.length>0){for(var h=0;h<this._toRemove.length;h++){var i=this._timeline.indexOf(this._toRemove[h]);-1!==i&&this._timeline.splice(i,1)}this._toRemove=[]}},b.Timeline.prototype.forEach=function(b){return this._iterate(b),this},b.Timeline.prototype.forEachBefore=function(b,u){var t=this._search(b);return-1!==t&&this._iterate(u,0,t),this},b.Timeline.prototype.forEachAfter=function(b,u){var t=this._search(b);return this._iterate(u,t+1),this},b.Timeline.prototype.forEachFrom=function(b,u){for(var t=this._search(b);t>=0&&this._timeline[t].time>=b;)t--;return this._iterate(u,t+1),this},b.Timeline.prototype.forEachAtTime=function(b,u){var t=this._search(b);return-1!==t&&this._iterate(function(t){t.time===b&&u(t)},0,t),this},b.Timeline.prototype.dispose=function(){b.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},b.Timeline}),u(function(b){
//	MIT License, copyright (c) 2014 Jordan Santell
///////////////////////////////////////////////////////////////////////////
/**
		 *  Calculates the the value along the curve produced by setTargetAtTime
		 *  @private
		 */
return b.TimelineSignal=function(){var u=this.optionsObject(arguments,["value","units"],b.Signal.defaults);this._events=new b.Timeline(10),b.Signal.apply(this,u),u.param=this._param,b.Param.call(this,u),this._initial=this._fromUnits(this._param.value)},b.extend(b.TimelineSignal,b.Param),b.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(b.TimelineSignal.prototype,"value",{get:function(){var b=this.now(),u=this.getValueAtTime(b);return this._toUnits(u)},set:function(b){var u=this._fromUnits(b);this._initial=u,this.cancelScheduledValues(),this._param.value=u}}),b.TimelineSignal.prototype.setValueAtTime=function(u,t){return u=this._fromUnits(u),t=this.toSeconds(t),this._events.add({type:b.TimelineSignal.Type.Set,value:u,time:t}),this._param.setValueAtTime(u,t),this},b.TimelineSignal.prototype.linearRampToValueAtTime=function(u,t){return u=this._fromUnits(u),t=this.toSeconds(t),this._events.add({type:b.TimelineSignal.Type.Linear,value:u,time:t}),this._param.linearRampToValueAtTime(u,t),this},b.TimelineSignal.prototype.exponentialRampToValueAtTime=function(u,t){t=this.toSeconds(t);var c=this._searchBefore(t);c&&0===c.value&&this.setValueAtTime(this._minOutput,c.time),u=this._fromUnits(u);var h=Math.max(u,this._minOutput);return this._events.add({type:b.TimelineSignal.Type.Exponential,value:h,time:t}),u<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,t-this.sampleTime),this.setValueAtTime(0,t)):this._param.exponentialRampToValueAtTime(u,t),this},b.TimelineSignal.prototype.setTargetAtTime=function(u,t,c){return u=this._fromUnits(u),u=Math.max(this._minOutput,u),c=Math.max(this._minOutput,c),t=this.toSeconds(t),this._events.add({type:b.TimelineSignal.Type.Target,value:u,time:t,constant:c}),this._param.setTargetAtTime(u,t,c),this},b.TimelineSignal.prototype.setValueCurveAtTime=function(u,t,c,h){h=this.defaultArg(h,1);for(var i=new Array(u.length),bb=0;bb<i.length;bb++)i[bb]=this._fromUnits(u[bb])*h;t=this.toSeconds(t),c=this.toSeconds(c),this._events.add({type:b.TimelineSignal.Type.Curve,value:i,time:t,duration:c}),this._param.setValueAtTime(i[0],t);for(var ub=1;ub<i.length;ub++){var tb=t+ub/(i.length-1)*c;this._param.linearRampToValueAtTime(i[ub],tb)}return this},b.TimelineSignal.prototype.cancelScheduledValues=function(b){return b=this.toSeconds(b),this._events.cancel(b),this._param.cancelScheduledValues(b),this},b.TimelineSignal.prototype.setRampPoint=function(u){u=this.toSeconds(u);var t=this._toUnits(this.getValueAtTime(u)),c=this._searchBefore(u);if(c&&c.time===u)this.cancelScheduledValues(u+this.sampleTime);else if(c&&c.type===b.TimelineSignal.Type.Curve&&c.time+c.duration>u)this.cancelScheduledValues(u),this.linearRampToValueAtTime(t,u);else{var h=this._searchAfter(u);h&&(this.cancelScheduledValues(u),h.type===b.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(t,u):h.type===b.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(t,u)),this.setValueAtTime(t,u)}return this},b.TimelineSignal.prototype.linearRampToValueBetween=function(b,u,t){return this.setRampPoint(u),this.linearRampToValueAtTime(b,t),this},b.TimelineSignal.prototype.exponentialRampToValueBetween=function(b,u,t){return this.setRampPoint(u),this.exponentialRampToValueAtTime(b,t),this},b.TimelineSignal.prototype._searchBefore=function(b){return this._events.get(b)},b.TimelineSignal.prototype._searchAfter=function(b){return this._events.getAfter(b)},b.TimelineSignal.prototype.getValueAtTime=function(u){u=this.toSeconds(u);var t=this._searchAfter(u),c=this._searchBefore(u),h=this._initial;if(null===c)h=this._initial;else if(c.type===b.TimelineSignal.Type.Target){var i,bb=this._events.getBefore(c.time);i=null===bb?this._initial:bb.value,h=this._exponentialApproach(c.time,i,c.value,c.constant,u)}else h=c.type===b.TimelineSignal.Type.Curve?this._curveInterpolate(c.time,c.value,c.duration,u):null===t?c.value:t.type===b.TimelineSignal.Type.Linear?this._linearInterpolate(c.time,c.value,t.time,t.value,u):t.type===b.TimelineSignal.Type.Exponential?this._exponentialInterpolate(c.time,c.value,t.time,t.value,u):c.value;return h},b.TimelineSignal.prototype.connect=b.SignalBase.prototype.connect,b.TimelineSignal.prototype._exponentialApproach=function(b,u,t,c,h){return t+(u-t)*Math.exp(-(h-b)/c)},b.TimelineSignal.prototype._linearInterpolate=function(b,u,t,c,h){return u+(c-u)*((h-b)/(t-b))},b.TimelineSignal.prototype._exponentialInterpolate=function(b,u,t,c,h){return u=Math.max(this._minOutput,u),u*Math.pow(c/u,(h-b)/(t-b))},b.TimelineSignal.prototype._curveInterpolate=function(b,u,t,c){var h=u.length;if(c>=b+t)return u[h-1];if(b>=c)return u[0];var i=(c-b)/t,bb=Math.floor((h-1)*i),ub=Math.ceil((h-1)*i),tb=u[bb],cb=u[ub];return ub===bb?tb:this._linearInterpolate(bb,tb,ub,cb,i*(h-1))},b.TimelineSignal.prototype.dispose=function(){b.Signal.prototype.dispose.call(this),b.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},b.TimelineSignal}),u(function(b){return b.Pow=function(u){this._exp=this.defaultArg(u,1),this._expScaler=this.input=this.output=new b.WaveShaper(this._expFunc(this._exp),8192)},b.extend(b.Pow,b.SignalBase),Object.defineProperty(b.Pow.prototype,"value",{get:function(){return this._exp},set:function(b){this._exp=b,this._expScaler.setMap(this._expFunc(this._exp))}}),b.Pow.prototype._expFunc=function(b){return function(u){return Math.pow(Math.abs(u),b)}},b.Pow.prototype.dispose=function(){return b.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},b.Pow}),u(function(b){return b.Envelope=function(){var u=this.optionsObject(arguments,["attack","decay","sustain","release"],b.Envelope.defaults);this.attack=u.attack,this.decay=u.decay,this.sustain=u.sustain,this.release=u.release,this._attackCurve="linear",this._releaseCurve="exponential",this._sig=this.output=new b.TimelineSignal,this._sig.setValueAtTime(0,0),this.attackCurve=u.attackCurve,this.releaseCurve=u.releaseCurve},b.extend(b.Envelope),b.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(b.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(b.Envelope.prototype,"attackCurve",{get:function(){if(this.isString(this._attackCurve))return this._attackCurve;if(this.isArray(this._attackCurve)){for(var u in b.Envelope.Type)if(b.Envelope.Type[u].In===this._attackCurve)return u;return this._attackCurve}},set:function(u){if(b.Envelope.Type.hasOwnProperty(u)){var t=b.Envelope.Type[u];this.isObject(t)?this._attackCurve=t.In:this._attackCurve=t}else{if(!this.isArray(u))throw new Error("Tone.Envelope: invalid curve: "+u);this._attackCurve=u}}}),Object.defineProperty(b.Envelope.prototype,"releaseCurve",{get:function(){if(this.isString(this._releaseCurve))return this._releaseCurve;if(this.isArray(this._releaseCurve)){for(var u in b.Envelope.Type)if(b.Envelope.Type[u].Out===this._releaseCurve)return u;return this._releaseCurve}},set:function(u){if(b.Envelope.Type.hasOwnProperty(u)){var t=b.Envelope.Type[u];this.isObject(t)?this._releaseCurve=t.Out:this._releaseCurve=t}else{if(!this.isArray(u))throw new Error("Tone.Envelope: invalid curve: "+u);this._releaseCurve=u}}}),b.Envelope.prototype.triggerAttack=function(b,u){b=this.toSeconds(b);var t=this.toSeconds(this.attack),c=t,h=this.toSeconds(this.decay);u=this.defaultArg(u,1);var i=this.getValueAtTime(b);if(i>0){var bb=1/c,ub=1-i;c=ub/bb}if("linear"===this._attackCurve)this._sig.linearRampToValue(u,c,b);else if("exponential"===this._attackCurve)this._sig.exponentialRampToValue(u,c,b);else if(c>0){this._sig.setRampPoint(b);var tb=this._attackCurve;if(t>c){var cb=1-c/t,hb=Math.floor(cb*this._attackCurve.length);tb=this._attackCurve.slice(hb),tb[0]=i}this._sig.setValueCurveAtTime(tb,b,c,u)}return this._sig.exponentialRampToValue(u*this.sustain,h,c+b),this},b.Envelope.prototype.triggerRelease=function(b){b=this.toSeconds(b);var u=this.getValueAtTime(b);if(u>0){var t=this.toSeconds(this.release);if("linear"===this._releaseCurve)this._sig.linearRampToValue(0,t,b);else if("exponential"===this._releaseCurve)this._sig.exponentialRampToValue(0,t,b);else{var c=this._releaseCurve;this.isArray(c)&&(this._sig.setRampPoint(b),this._sig.setValueCurveAtTime(c,b,t,u))}}return this},b.Envelope.prototype.getValueAtTime=function(b){return this._sig.getValueAtTime(b)},b.Envelope.prototype.triggerAttackRelease=function(b,u,t){return u=this.toSeconds(u),this.triggerAttack(u,t),this.triggerRelease(u+this.toSeconds(b)),this},b.Envelope.prototype.cancel=function(b){return this._sig.cancelScheduledValues(b),this},b.Envelope.prototype.connect=b.Signal.prototype.connect,function(){function u(b){for(var u=new Array(b.length),t=0;t<b.length;t++)u[t]=1-b[t];return u}function t(b){return b.slice(0).reverse()}var c,h,i=128,bb=[];for(c=0;i>c;c++)bb[c]=Math.sin(c/(i-1)*(Math.PI/2));var ub=[],tb=6.4;for(c=0;i-1>c;c++){h=c/(i-1);var cb=Math.sin(h*(2*Math.PI)*tb-Math.PI/2)+1;ub[c]=cb/10+.83*h}ub[i-1]=1;var hb=[],ib=5;for(c=0;i>c;c++)hb[c]=Math.ceil(c/(i-1)*ib)/ib;var bu=[];for(c=0;i>c;c++)h=c/(i-1),bu[c]=.5*(1-Math.cos(Math.PI*h));var uu=[];for(c=0;i>c;c++){h=c/(i-1);var tu=4*Math.pow(h,3)+.2,cu=Math.cos(tu*Math.PI*2*h);uu[c]=Math.abs(cu*(1-h))}b.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:u(uu),Out:uu},cosine:{In:bb,Out:t(bb)},step:{In:hb,Out:u(hb)},ripple:{In:ub,Out:u(ub)},sine:{In:bu,Out:u(bu)}}}(),b.Envelope.prototype.dispose=function(){return b.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},b.Envelope}),u(function(b){return b.AmplitudeEnvelope=function(){b.Envelope.apply(this,arguments),this.input=this.output=new b.Gain,this._sig.connect(this.output.gain)},b.extend(b.AmplitudeEnvelope,b.Envelope),b.AmplitudeEnvelope.prototype.dispose=function(){return this.input.dispose(),this.input=null,b.Envelope.prototype.dispose.call(this),this},b.AmplitudeEnvelope}),u(function(b){return window.AnalyserNode&&!AnalyserNode.prototype.getFloatTimeDomainData&&(AnalyserNode.prototype.getFloatTimeDomainData=function(b){var u=new Uint8Array(b.length);this.getByteTimeDomainData(u);for(var t=0;t<u.length;t++)b[t]=(u[t]-128)/128}),b.Analyser=function(){var u=this.optionsObject(arguments,["type","size"],b.Analyser.defaults);this._analyser=this.input=this.output=this.context.createAnalyser(),this._type=u.type,this._returnType=u.returnType,this._buffer=null,this.size=u.size,this.type=u.type,this.returnType=u.returnType,this.minDecibels=u.minDecibels,this.maxDecibels=u.maxDecibels},b.extend(b.Analyser),b.Analyser.defaults={size:1024,returnType:"byte",type:"fft",smoothing:.8,maxDecibels:-30,minDecibels:-100},b.Analyser.Type={Waveform:"waveform",FFT:"fft"},b.Analyser.ReturnType={Byte:"byte",Float:"float"},b.Analyser.prototype.analyse=function(){return this._type===b.Analyser.Type.FFT?this._returnType===b.Analyser.ReturnType.Byte?this._analyser.getByteFrequencyData(this._buffer):this._analyser.getFloatFrequencyData(this._buffer):this._type===b.Analyser.Type.Waveform&&(this._returnType===b.Analyser.ReturnType.Byte?this._analyser.getByteTimeDomainData(this._buffer):this._analyser.getFloatTimeDomainData(this._buffer)),this._buffer},Object.defineProperty(b.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(b){this._analyser.fftSize=2*b,this.type=this._type}}),Object.defineProperty(b.Analyser.prototype,"returnType",{get:function(){return this._returnType},set:function(u){if(u===b.Analyser.ReturnType.Byte)this._buffer=new Uint8Array(this._analyser.frequencyBinCount);else{if(u!==b.Analyser.ReturnType.Float)throw new TypeError("Tone.Analayser: invalid return type: "+u);this._buffer=new Float32Array(this._analyser.frequencyBinCount)}this._returnType=u}}),Object.defineProperty(b.Analyser.prototype,"type",{get:function(){return this._type},set:function(u){if(u!==b.Analyser.Type.Waveform&&u!==b.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+u);this._type=u}}),Object.defineProperty(b.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(b){this._analyser.smoothingTimeConstant=b}}),Object.defineProperty(b.Analyser.prototype,"minDecibels",{get:function(){return this._analyser.minDecibels},set:function(b){this._analyser.minDecibels=b}}),Object.defineProperty(b.Analyser.prototype,"maxDecibels",{get:function(){return this._analyser.maxDecibels},set:function(b){this._analyser.maxDecibels=b}}),b.Analyser.prototype.dispose=function(){b.prototype.dispose.call(this),this._analyser.disconnect(),this._analyser=null,this._buffer=null},b.Analyser}),u(function(b){return b.Compressor=function(){var u=this.optionsObject(arguments,["threshold","ratio"],b.Compressor.defaults);this._compressor=this.input=this.output=this.context.createDynamicsCompressor(),this.threshold=new b.Param({param:this._compressor.threshold,units:b.Type.Decibels,convert:!1}),this.attack=new b.Param(this._compressor.attack,b.Type.Time),this.release=new b.Param(this._compressor.release,b.Type.Time),this.knee=new b.Param({param:this._compressor.knee,units:b.Type.Decibels,convert:!1}),this.ratio=new b.Param({param:this._compressor.ratio,convert:!1}),this._readOnly(["knee","release","attack","ratio","threshold"]),this.set(u)},b.extend(b.Compressor),b.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},b.Compressor.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=null,this.knee.dispose(),this.knee=null,this},b.Compressor}),u(function(b){return b.Add=function(u){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new b.Gain,this._param=this.input[1]=new b.Signal(u),this._param.connect(this._sum)},b.extend(b.Add,b.Signal),b.Add.prototype.dispose=function(){return b.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},b.Add}),u(function(b){return b.Multiply=function(u){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new b.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(u,0)},b.extend(b.Multiply,b.Signal),b.Multiply.prototype.dispose=function(){return b.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},b.Multiply}),u(function(b){return b.Negate=function(){this._multiply=this.input=this.output=new b.Multiply(-1)},b.extend(b.Negate,b.SignalBase),b.Negate.prototype.dispose=function(){return b.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},b.Negate}),u(function(b){return b.Subtract=function(u){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new b.Gain,this._neg=new b.Negate,this._param=this.input[1]=new b.Signal(u),this._param.chain(this._neg,this._sum)},b.extend(b.Subtract,b.Signal),b.Subtract.prototype.dispose=function(){return b.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},b.Subtract}),u(function(b){return b.GreaterThanZero=function(){this._thresh=this.output=new b.WaveShaper(function(b){return 0>=b?0:1},127),this._scale=this.input=new b.Multiply(1e4),this._scale.connect(this._thresh)},b.extend(b.GreaterThanZero,b.SignalBase),b.GreaterThanZero.prototype.dispose=function(){return b.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},b.GreaterThanZero}),u(function(b){return b.GreaterThan=function(u){this.createInsOuts(2,0),this._param=this.input[0]=new b.Subtract(u),this.input[1]=this._param.input[1],this._gtz=this.output=new b.GreaterThanZero,this._param.connect(this._gtz)},b.extend(b.GreaterThan,b.Signal),b.GreaterThan.prototype.dispose=function(){return b.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},b.GreaterThan}),u(function(b){return b.Abs=function(){this._abs=this.input=this.output=new b.WaveShaper(function(b){return 0===b?0:Math.abs(b)},127)},b.extend(b.Abs,b.SignalBase),b.Abs.prototype.dispose=function(){return b.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},b.Abs}),u(function(b){return b.Modulo=function(u){this.createInsOuts(1,0),this._shaper=new b.WaveShaper(Math.pow(2,16)),this._multiply=new b.Multiply,this._subtract=this.output=new b.Subtract,this._modSignal=new b.Signal(u),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(u)},b.extend(b.Modulo,b.SignalBase),b.Modulo.prototype._setWaveShaper=function(b){this._shaper.setMap(function(u){var t=Math.floor((u+1e-4)/b);return t})},Object.defineProperty(b.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(b){this._modSignal.value=b,this._setWaveShaper(b)}}),b.Modulo.prototype.dispose=function(){return b.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},b.Modulo}),u(function(b){return b.AudioToGain=function(){this._norm=this.input=this.output=new b.WaveShaper(function(b){return(b+1)/2})},b.extend(b.AudioToGain,b.SignalBase),b.AudioToGain.prototype.dispose=function(){return b.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},b.AudioToGain}),u(function(b){function u(b,u,t){var c=new b;return t._eval(u[0]).connect(c,0,0),t._eval(u[1]).connect(c,0,1),c}function t(b,u,t){var c=new b;return t._eval(u[0]).connect(c,0,0),c}function c(b){return b?parseFloat(b):void 0}function h(b){return b&&b.args?parseFloat(b.args):void 0}/**
		 *  @class Evaluate an expression at audio rate. <br><br>
		 *         Parsing code modified from https://code.google.com/p/tapdigit/
		 *         Copyright 2011 2012 Ariya Hidayat, New BSD License
		 *
		 *  @extends {Tone.SignalBase}
		 *  @constructor
		 *  @param {string} expr the expression to generate
		 *  @example
		 * //adds the signals from input[0] and input[1].
		 * var expr = new Tone.Expr("$0 + $1");
		 */
return b.Expr=function(){var b=this._replacements(Array.prototype.slice.call(arguments)),u=this._parseInputs(b);this._nodes=[],this.input=new Array(u);for(var t=0;u>t;t++)this.input[t]=this.context.createGain();var c,h=this._parseTree(b);try{c=this._eval(h)}catch(i){throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+b)}this.output=c},b.extend(b.Expr,b.SignalBase),b.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(u){var t=new b.Signal(c(u));return t}},input:{regexp:/^\$\d/,method:function(b,u){return u.input[c(b.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:t.bind(this,b.Abs)},mod:{regexp:/^mod/,method:function(u,t){var c=h(u[1]),i=new b.Modulo(c);return t._eval(u[0]).connect(i),i}},pow:{regexp:/^pow/,method:function(u,t){var c=h(u[1]),i=new b.Pow(c);return t._eval(u[0]).connect(i),i}},a2g:{regexp:/^a2g/,method:function(u,t){var c=new b.AudioToGain;return t._eval(u[0]).connect(c),c}}},binary:{"+":{regexp:/^\+/,precedence:1,method:u.bind(this,b.Add)},"-":{regexp:/^\-/,precedence:1,method:function(c,h){return 1===c.length?t(b.Negate,c,h):u(b.Subtract,c,h)}},"*":{regexp:/^\*/,precedence:0,method:u.bind(this,b.Multiply)}},unary:{"-":{regexp:/^\-/,method:t.bind(this,b.Negate)},"!":{regexp:/^\!/,method:t.bind(this,b.NOT)}}},b.Expr.prototype._parseInputs=function(b){var u=b.match(/\$\d/g),t=0;if(null!==u)for(var c=0;c<u.length;c++){var h=parseInt(u[c].substr(1))+1;t=Math.max(t,h)}return t},b.Expr.prototype._replacements=function(b){for(var u=b.shift(),t=0;t<b.length;t++)u=u.replace(/\%/i,b[t]);return u},b.Expr.prototype._tokenize=function(u){function t(u){for(var t in b.Expr._Expressions){var c=b.Expr._Expressions[t];for(var h in c){var i=c[h],bb=i.regexp,ub=u.match(bb);if(null!==ub)return{type:t,value:ub[0],method:i.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+u)}for(var c=-1,h=[];u.length>0;){u=u.trim();var i=t(u);h.push(i),u=u.substr(i.value.length)}return{next:function(){return h[++c]},peek:function(){return h[c+1]}}},b.Expr.prototype._parseTree=function(u){function t(b,u){return!hb(b)&&"glue"===b.type&&b.value===u}function c(u,t,c){var h=!1,i=b.Expr._Expressions[t];if(!hb(u))for(var bb in i){var ub=i[bb];if(ub.regexp.test(u.value)){if(hb(c))return!0;if(ub.precedence===c)return!0}}return h}function h(b){hb(b)&&(b=5);var u;u=0>b?i():h(b-1);for(var t=cb.peek();c(t,"binary",b);)t=cb.next(),u={operator:t.value,method:t.method,args:[u,h(b-1)]},t=cb.peek();return u}function i(){var b,u;return b=cb.peek(),c(b,"unary")?(b=cb.next(),u=i(),{operator:b.value,method:b.method,args:[u]}):bb()}function bb(){var b,u;if(b=cb.peek(),hb(b))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if("func"===b.type)return b=cb.next(),ub(b);if("value"===b.type)return b=cb.next(),{method:b.method,args:b.value};if(t(b,"(")){if(cb.next(),u=h(),b=cb.next(),!t(b,")"))throw new SyntaxError("Expected )");return u}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+b.value)}function ub(b){var u,c=[];if(u=cb.next(),!t(u,"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+b.value+'"');if(u=cb.peek(),t(u,")")||(c=tb()),u=cb.next(),!t(u,")"))throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+b.value+'"');return{method:b.method,args:c,name:name}}function tb(){for(var b,u,c=[];;){if(u=h(),hb(u))break;if(c.push(u),b=cb.peek(),!t(b,","))break;cb.next()}return c}var cb=this._tokenize(u),hb=this.isUndef.bind(this);return h()},b.Expr.prototype._eval=function(b){if(!this.isUndef(b)){var u=b.method(b.args,this);return this._nodes.push(u),u}},b.Expr.prototype._disposeNodes=function(){for(var b=0;b<this._nodes.length;b++){var u=this._nodes[b];this.isFunction(u.dispose)?u.dispose():this.isFunction(u.disconnect)&&u.disconnect(),u=null,this._nodes[b]=null}this._nodes=null},b.Expr.prototype.dispose=function(){b.prototype.dispose.call(this),this._disposeNodes()},b.Expr}),u(function(b){return b.EqualPowerGain=function(){this._eqPower=this.input=this.output=new b.WaveShaper(function(b){return Math.abs(b)<.001?0:this.equalPowerScale(b)}.bind(this),4096)},b.extend(b.EqualPowerGain,b.SignalBase),b.EqualPowerGain.prototype.dispose=function(){return b.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},b.EqualPowerGain}),u(function(b){return b.CrossFade=function(u){this.createInsOuts(2,1),this.a=this.input[0]=new b.Gain,this.b=this.input[1]=new b.Gain,this.fade=new b.Signal(this.defaultArg(u,.5),b.Type.NormalRange),this._equalPowerA=new b.EqualPowerGain,this._equalPowerB=new b.EqualPowerGain,this._invert=new b.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},b.extend(b.CrossFade),b.CrossFade.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},b.CrossFade}),u(function(b){return b.Filter=function(){this.createInsOuts(1,1);var u=this.optionsObject(arguments,["frequency","type","rolloff"],b.Filter.defaults);this._filters=[],this.frequency=new b.Signal(u.frequency,b.Type.Frequency),this.detune=new b.Signal(0,b.Type.Cents),this.gain=new b.Signal({value:u.gain,convert:!1}),this.Q=new b.Signal(u.Q),this._type=u.type,this._rolloff=u.rolloff,this.rolloff=u.rolloff,this._readOnly(["detune","frequency","gain","Q"])},b.extend(b.Filter),b.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(b.Filter.prototype,"type",{get:function(){return this._type},set:function(b){var u=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(-1===u.indexOf(b))throw new TypeError("Tone.Filter: invalid type "+b);this._type=b;for(var t=0;t<this._filters.length;t++)this._filters[t].type=b}}),Object.defineProperty(b.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(b){b=parseInt(b,10);var u=[-12,-24,-48,-96],t=u.indexOf(b);if(-1===t)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");t+=1,this._rolloff=b,this.input.disconnect();for(var c=0;c<this._filters.length;c++)this._filters[c].disconnect(),this._filters[c]=null;this._filters=new Array(t);for(var h=0;t>h;h++){var i=this.context.createBiquadFilter();i.type=this._type,this.frequency.connect(i.frequency),this.detune.connect(i.detune),this.Q.connect(i.Q),this.gain.connect(i.gain),this._filters[h]=i}var bb=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,bb)}}),b.Filter.prototype.dispose=function(){b.prototype.dispose.call(this);for(var u=0;u<this._filters.length;u++)this._filters[u].disconnect(),this._filters[u]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},b.Filter}),u(function(b){return b.MultibandSplit=function(){var u=this.optionsObject(arguments,["lowFrequency","highFrequency"],b.MultibandSplit.defaults);this.input=new b.Gain,this.output=new Array(3),this.low=this.output[0]=new b.Filter(0,"lowpass"),this._lowMidFilter=new b.Filter(0,"highpass"),this.mid=this.output[1]=new b.Filter(0,"lowpass"),this.high=this.output[2]=new b.Filter(0,"highpass"),this.lowFrequency=new b.Signal(u.lowFrequency,b.Type.Frequency),this.highFrequency=new b.Signal(u.highFrequency,b.Type.Frequency),this.Q=new b.Signal(u.Q),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},b.extend(b.MultibandSplit),b.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},b.MultibandSplit.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),this.highFrequency=null,this.Q.dispose(),this.Q=null,this},b.MultibandSplit}),u(function(b){return b.EQ3=function(){var u=this.optionsObject(arguments,["low","mid","high"],b.EQ3.defaults);this.output=new b.Gain,this._multibandSplit=this.input=new b.MultibandSplit({lowFrequency:u.lowFrequency,highFrequency:u.highFrequency}),this._lowGain=new b.Gain(u.low,b.Type.Decibels),this._midGain=new b.Gain(u.mid,b.Type.Decibels),this._highGain=new b.Gain(u.high,b.Type.Decibels),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},b.extend(b.EQ3),b.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},b.EQ3.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},b.EQ3}),u(function(b){return b.Scale=function(u,t){this._outputMin=this.defaultArg(u,0),this._outputMax=this.defaultArg(t,1),this._scale=this.input=new b.Multiply(1),this._add=this.output=new b.Add(0),this._scale.connect(this._add),this._setRange()},b.extend(b.Scale,b.SignalBase),Object.defineProperty(b.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(b){this._outputMin=b,this._setRange()}}),Object.defineProperty(b.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(b){this._outputMax=b,this._setRange()}}),b.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},b.Scale.prototype.dispose=function(){return b.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},b.Scale}),u(function(b){return b.ScaleExp=function(u,t,c){this._scale=this.output=new b.Scale(u,t),this._exp=this.input=new b.Pow(this.defaultArg(c,2)),this._exp.connect(this._scale)},b.extend(b.ScaleExp,b.SignalBase),Object.defineProperty(b.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(b){this._exp.value=b}}),Object.defineProperty(b.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(b){this._scale.min=b}}),Object.defineProperty(b.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(b){this._scale.max=b}}),b.ScaleExp.prototype.dispose=function(){return b.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},b.ScaleExp}),u(function(b){return window.DelayNode&&!AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),b.Delay=function(){var u=this.optionsObject(arguments,["delayTime","maxDelay"],b.Delay.defaults);this._delayNode=this.input=this.output=this.context.createDelay(this.toSeconds(u.maxDelay)),this.delayTime=new b.Param({param:this._delayNode.delayTime,units:b.Type.Time,value:u.delayTime}),this._readOnly("delayTime")},b.extend(b.Delay),b.Delay.defaults={maxDelay:1,delayTime:0},b.Delay.prototype.dispose=function(){return b.Param.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},b.Delay}),u(function(b){return b.FeedbackCombFilter=function(){var u=this.optionsObject(arguments,["delayTime","resonance"],b.FeedbackCombFilter.defaults);this._delay=this.input=this.output=new b.Delay(u.delayTime),this.delayTime=this._delay.delayTime,this._feedback=new b.Gain(u.resonance,b.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._feedback,this._delay),this._readOnly(["resonance","delayTime"])},b.extend(b.FeedbackCombFilter),b.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},b.FeedbackCombFilter.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},b.FeedbackCombFilter}),u(function(b){return b.Follower=function(){this.createInsOuts(1,1);var u=this.optionsObject(arguments,["attack","release"],b.Follower.defaults);this._abs=new b.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new b.WaveShaper,this._sub=new b.Subtract,this._delay=new b.Delay(this.blockTime),this._mult=new b.Multiply(1e4),this._attack=u.attack,this._release=u.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},b.extend(b.Follower),b.Follower.defaults={attack:.05,release:.5},b.Follower.prototype._setAttackRelease=function(u,t){var c=this.blockTime;u=b.Time(u).toFrequency(),t=b.Time(t).toFrequency(),u=Math.max(u,c),t=Math.max(t,c),this._frequencyValues.setMap(function(b){return 0>=b?u:t})},Object.defineProperty(b.Follower.prototype,"attack",{get:function(){return this._attack},set:function(b){this._attack=b,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(b.Follower.prototype,"release",{get:function(){return this._release},set:function(b){this._release=b,this._setAttackRelease(this._attack,this._release)}}),b.Follower.prototype.connect=b.Signal.prototype.connect,b.Follower.prototype.dispose=function(){return b.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},b.Follower}),u(function(b){return b.ScaledEnvelope=function(){var u=this.optionsObject(arguments,["attack","decay","sustain","release"],b.Envelope.defaults);b.Envelope.call(this,u),u=this.defaultArg(u,b.ScaledEnvelope.defaults),this._exp=this.output=new b.Pow(u.exponent),this._scale=this.output=new b.Scale(u.min,u.max),this._sig.chain(this._exp,this._scale)},b.extend(b.ScaledEnvelope,b.Envelope),b.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(b.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(b){this._scale.min=b}}),Object.defineProperty(b.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(b){this._scale.max=b}}),Object.defineProperty(b.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(b){this._exp.value=b}}),b.ScaledEnvelope.prototype.dispose=function(){return b.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},b.ScaledEnvelope}),u(function(b){return b.FrequencyEnvelope=function(){var u=this.optionsObject(arguments,["attack","decay","sustain","release"],b.Envelope.defaults);b.ScaledEnvelope.call(this,u),u=this.defaultArg(u,b.FrequencyEnvelope.defaults),this._octaves=u.octaves,this.baseFrequency=u.baseFrequency,this.octaves=u.octaves},b.extend(b.FrequencyEnvelope,b.Envelope),b.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(b.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(b){this._scale.min=this.toFrequency(b),this.octaves=this._octaves}}),Object.defineProperty(b.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(b){this._octaves=b,this._scale.max=this.baseFrequency*Math.pow(2,b)}}),Object.defineProperty(b.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(b){this._exp.value=b}}),b.FrequencyEnvelope.prototype.dispose=function(){return b.ScaledEnvelope.prototype.dispose.call(this),this},b.FrequencyEnvelope}),u(function(b){return b.Gate=function(){this.createInsOuts(1,1);var u=this.optionsObject(arguments,["threshold","attack","release"],b.Gate.defaults);this._follower=new b.Follower(u.attack,u.release),this._gt=new b.GreaterThan(this.dbToGain(u.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},b.extend(b.Gate),b.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(b.Gate.prototype,"threshold",{get:function(){return this.gainToDb(this._gt.value)},set:function(b){this._gt.value=this.dbToGain(b)}}),Object.defineProperty(b.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(b){this._follower.attack=b}}),Object.defineProperty(b.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(b){this._follower.release=b}}),b.Gate.prototype.dispose=function(){return b.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},b.Gate}),u(function(b){return b.TimelineState=function(u){b.Timeline.call(this),this._initial=u},b.extend(b.TimelineState,b.Timeline),b.TimelineState.prototype.getValueAtTime=function(b){var u=this.get(b);return null!==u?u.state:this._initial},b.TimelineState.prototype.setStateAtTime=function(b,u){this.add({state:b,time:u})},b.TimelineState}),u(function(b){return b.Clock=function(){b.Emitter.call(this);var u=this.optionsObject(arguments,["callback","frequency"],b.Clock.defaults);this.callback=u.callback,this._nextTick=0,this._lastState=b.State.Stopped,this.frequency=new b.TimelineSignal(u.frequency,b.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new b.TimelineState(b.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},b.extend(b.Clock,b.Emitter),b.Clock.defaults={callback:b.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(b.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),b.Clock.prototype.start=function(u,t){return u=this.toSeconds(u),this._state.getValueAtTime(u)!==b.State.Started&&this._state.add({state:b.State.Started,time:u,offset:t}),this},b.Clock.prototype.stop=function(u){return u=this.toSeconds(u),this._state.cancel(u),this._state.setStateAtTime(b.State.Stopped,u),this},b.Clock.prototype.pause=function(u){return u=this.toSeconds(u),this._state.getValueAtTime(u)===b.State.Started&&this._state.setStateAtTime(b.State.Paused,u),this},b.Clock.prototype._loop=function(){for(var u=this.now(),t=this.context.lookAhead,c=this.context.updateInterval,h=2*this.context.lag,i=u+t+c+h;i>this._nextTick&&this._state;){var bb=this._state.getValueAtTime(this._nextTick);if(bb!==this._lastState){this._lastState=bb;var ub=this._state.get(this._nextTick);bb===b.State.Started?(this._nextTick=ub.time,this.isUndef(ub.offset)||(this.ticks=ub.offset),this.emit("start",ub.time,this.ticks)):bb===b.State.Stopped?(this.ticks=0,this.emit("stop",ub.time)):bb===b.State.Paused&&this.emit("pause",ub.time)}var tb=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),bb===b.State.Started&&(this.callback(tb),this.ticks++))}},b.Clock.prototype.getStateAtTime=function(b){return b=this.toSeconds(b),this._state.getValueAtTime(b)},b.Clock.prototype.dispose=function(){b.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},b.Clock}),u(function(b){b.IntervalTimeline=function(){this._root=null,this._length=0},b.extend(b.IntervalTimeline),b.IntervalTimeline.prototype.add=function(b){if(this.isUndef(b.time)||this.isUndef(b.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");var t=new u(b.time,b.time+b.duration,b);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this},b.IntervalTimeline.prototype.remove=function(b){if(null!==this._root){var u=[];this._root.search(b.time,u);for(var t=0;t<u.length;t++){var c=u[t];if(c.event===b){this._removeNode(c),this._length--;break}}}return this},Object.defineProperty(b.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),b.IntervalTimeline.prototype.cancel=function(b){return this.forEachAfter(b,function(b){this.remove(b)}.bind(this)),this},b.IntervalTimeline.prototype._setRoot=function(b){this._root=b,null!==this._root&&(this._root.parent=null)},b.IntervalTimeline.prototype._replaceNodeInParent=function(b,u){null!==b.parent?(b.isLeftChild()?b.parent.left=u:b.parent.right=u,this._rebalance(b.parent)):this._setRoot(u)},b.IntervalTimeline.prototype._removeNode=function(b){if(null===b.left&&null===b.right)this._replaceNodeInParent(b,null);else if(null===b.right)this._replaceNodeInParent(b,b.left);else if(null===b.left)this._replaceNodeInParent(b,b.right);else{var u,t,c=b.getBalance();if(c>0)if(null===b.left.right)u=b.left,u.right=b.right,t=u;else{for(u=b.left.right;null!==u.right;)u=u.right;u.parent.right=u.left,t=u.parent,u.left=b.left,u.right=b.right}else if(null===b.right.left)u=b.right,u.left=b.left,t=u;else{for(u=b.right.left;null!==u.left;)u=u.left;u.parent=u.parent,u.parent.left=u.right,t=u.parent,u.left=b.left,u.right=b.right}null!==b.parent?b.isLeftChild()?b.parent.left=u:b.parent.right=u:this._setRoot(u),this._rebalance(t)}b.dispose()},b.IntervalTimeline.prototype._rotateLeft=function(b){var u=b.parent,t=b.isLeftChild(),c=b.right;b.right=c.left,c.left=b,null!==u?t?u.left=c:u.right=c:this._setRoot(c)},b.IntervalTimeline.prototype._rotateRight=function(b){var u=b.parent,t=b.isLeftChild(),c=b.left;b.left=c.right,c.right=b,null!==u?t?u.left=c:u.right=c:this._setRoot(c)},b.IntervalTimeline.prototype._rebalance=function(b){var u=b.getBalance();u>1?b.left.getBalance()<0?this._rotateLeft(b.left):this._rotateRight(b):-1>u&&(b.right.getBalance()>0?this._rotateRight(b.right):this._rotateLeft(b))},b.IntervalTimeline.prototype.get=function(b){if(null!==this._root){var u=[];if(this._root.search(b,u),u.length>0){for(var t=u[0],c=1;c<u.length;c++)u[c].low>t.low&&(t=u[c]);return t.event}}return null},b.IntervalTimeline.prototype.forEach=function(b){if(null!==this._root){var u=[];null!==this._root&&this._root.traverse(function(b){u.push(b)});for(var t=0;t<u.length;t++){var c=u[t].event;c&&b(c)}}return this},b.IntervalTimeline.prototype.forEachAtTime=function(b,u){if(null!==this._root){var t=[];this._root.search(b,t);for(var c=t.length-1;c>=0;c--){var h=t[c].event;h&&u(h)}}return this},b.IntervalTimeline.prototype.forEachAfter=function(b,u){if(null!==this._root){var t=[];this._root.searchAfter(b,t);for(var c=t.length-1;c>=0;c--){var h=t[c].event;h&&u(h)}}return this},b.IntervalTimeline.prototype.dispose=function(){var b=[];null!==this._root&&this._root.traverse(function(u){b.push(u)});for(var u=0;u<b.length;u++)b[u].dispose();return b=null,this._root=null,this};var u=function(b,u,t){this.event=t,this.low=b,this.high=u,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return u.prototype.insert=function(b){b.low<=this.low?null===this.left?this.left=b:this.left.insert(b):null===this.right?this.right=b:this.right.insert(b)},u.prototype.search=function(b,u){b>this.max||(null!==this.left&&this.left.search(b,u),this.low<=b&&this.high>b&&u.push(this),this.low>b||null!==this.right&&this.right.search(b,u))},u.prototype.searchAfter=function(b,u){this.low>=b&&(u.push(this),null!==this.left&&this.left.searchAfter(b,u)),null!==this.right&&this.right.searchAfter(b,u)},u.prototype.traverse=function(b){b(this),null!==this.left&&this.left.traverse(b),null!==this.right&&this.right.traverse(b)},u.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},u.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},u.prototype.getBalance=function(){var b=0;return null!==this.left&&null!==this.right?b=this.left.height-this.right.height:null!==this.left?b=this.left.height+1:null!==this.right&&(b=-(this.right.height+1)),b},u.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(u.prototype,"left",{get:function(){return this._left},set:function(b){this._left=b,null!==b&&(b.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(u.prototype,"right",{get:function(){return this._right},set:function(b){this._right=b,null!==b&&(b.parent=this),this.updateHeight(),this.updateMax()}}),u.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},b.IntervalTimeline}),u(function(b){b.Transport=function(){b.Emitter.call(this),this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=u.defaults.PPQ,this._clock=new b.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=b.Type.BPM,this.bpm.value=u.defaults.bpm,this._readOnly("bpm"),this._timeSignature=u.defaults.timeSignature,this._scheduledEvents={},this._eventID=0,this._timeline=new b.Timeline,this._repeatedEvents=new b.IntervalTimeline,this._onceEvents=new b.Timeline,this._syncedSignals=[],this._swingTicks=u.defaults.PPQ/2,this._swingAmount=0},b.extend(b.Transport,b.Emitter),b.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},b.Transport.prototype._processTick=function(u){var t=this._clock.ticks;if(this._swingAmount>0&&t%this._ppq!==0&&t%(2*this._swingTicks)!==0){var c=t%(2*this._swingTicks)/(2*this._swingTicks),h=Math.sin(c*Math.PI)*this._swingAmount;u+=b.Time(2*this._swingTicks/3,"i")*h}this.loop&&t===this._loopEnd&&(this.emit("loopEnd",u),this._clock.ticks=this._loopStart,t=this._loopStart,this.emit("loopStart",u,this.seconds),this.emit("loop",u)),this._onceEvents.forEachBefore(t,function(b){b.callback(u),delete this._scheduledEvents[b.id.toString()]}.bind(this)),this._onceEvents.cancelBefore(t),this._timeline.forEachAtTime(t,function(b){b.callback(u)}),this._repeatedEvents.forEachAtTime(t,function(b){(t-b.time)%b.interval===0&&b.callback(u)})},b.Transport.prototype.schedule=function(b,u){var t={time:this.toTicks(u),callback:b},c=this._eventID++;return this._scheduledEvents[c.toString()]={event:t,timeline:this._timeline},this._timeline.add(t),c},b.Transport.prototype.scheduleRepeat=function(b,u,t,c){if(0>=u)throw new Error("Tone.Transport: repeat events must have an interval larger than 0");var h={time:this.toTicks(t),duration:this.toTicks(this.defaultArg(c,1/0)),interval:this.toTicks(u),callback:b},i=this._eventID++;return this._scheduledEvents[i.toString()]={event:h,timeline:this._repeatedEvents},this._repeatedEvents.add(h),i},b.Transport.prototype.scheduleOnce=function(b,u){var t=this._eventID++,c={time:this.toTicks(u),callback:b,id:t};return this._scheduledEvents[t.toString()]={event:c,timeline:this._onceEvents},this._onceEvents.add(c),t},b.Transport.prototype.clear=function(b){if(this._scheduledEvents.hasOwnProperty(b)){var u=this._scheduledEvents[b.toString()];u.timeline.remove(u.event),delete this._scheduledEvents[b.toString()]}return this},b.Transport.prototype.cancel=function(b){return b=this.defaultArg(b,0),b=this.toTicks(b),this._timeline.cancel(b),this._onceEvents.cancel(b),this._repeatedEvents.cancel(b),this},b.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(u,t){t=b.Time(this._clock.ticks,"i").toSeconds(),this.emit("start",u,t)}.bind(this)),this._clock.on("stop",function(b){this.emit("stop",b)}.bind(this)),this._clock.on("pause",function(b){this.emit("pause",b)}.bind(this))},Object.defineProperty(b.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),b.Transport.prototype.start=function(b,u){return this.isUndef(u)||(u=this.toTicks(u)),this._clock.start(b,u),this},b.Transport.prototype.stop=function(b){return this._clock.stop(b),this},b.Transport.prototype.pause=function(b){return this._clock.pause(b),this},Object.defineProperty(b.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(b){this.isArray(b)&&(b=b[0]/b[1]*4),this._timeSignature=b}}),Object.defineProperty(b.Transport.prototype,"loopStart",{get:function(){return b.TransportTime(this._loopStart,"i").toSeconds()},set:function(b){this._loopStart=this.toTicks(b)}}),Object.defineProperty(b.Transport.prototype,"loopEnd",{get:function(){return b.TransportTime(this._loopEnd,"i").toSeconds()},set:function(b){this._loopEnd=this.toTicks(b)}}),b.Transport.prototype.setLoopPoints=function(b,u){return this.loopStart=b,this.loopEnd=u,this},Object.defineProperty(b.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(b){this._swingAmount=b}}),Object.defineProperty(b.Transport.prototype,"swingSubdivision",{get:function(){return b.Time(this._swingTicks,"i").toNotation()},set:function(b){this._swingTicks=this.toTicks(b)}}),Object.defineProperty(b.Transport.prototype,"position",{get:function(){return b.TransportTime(this.ticks,"i").toBarsBeatsSixteenths()},set:function(b){var u=this.toTicks(b);this.ticks=u}}),Object.defineProperty(b.Transport.prototype,"seconds",{get:function(){return b.TransportTime(this.ticks,"i").toSeconds()},set:function(b){var u=this.toTicks(b);this.ticks=u}}),Object.defineProperty(b.Transport.prototype,"progress",{get:function(){return this.loop?(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart):0}}),Object.defineProperty(b.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(u){if(this._clock.ticks!==u){var t=this.now();this.state===b.State.Started?(this.emit("stop",t),this._clock.ticks=u,this.emit("start",t,this.seconds)):this._clock.ticks=u}}}),Object.defineProperty(b.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(b){var u=this.bpm.value;this._ppq=b,this.bpm.value=u}}),Object.defineProperty(b.Transport.prototype,"latencyHint",{get:function(){return b.Clock.latencyHint},set:function(u){b.Clock.latencyHint=u}}),b.Transport.prototype._fromUnits=function(b){return 1/(60/b/this.PPQ)},b.Transport.prototype._toUnits=function(b){return b/this.PPQ*60},b.Transport.prototype.nextSubdivision=function(u){u=this.toSeconds(u);var t;if(this.state!==b.State.Started)return 0;t=this._clock._nextTick;
var c=b.Time(this.ticks,"i"),h=u-c%u;return 0===h&&(h=u),t+h},b.Transport.prototype.syncSignal=function(u,t){t||(t=0!==u._param.value?u._param.value/this.bpm._param.value:0);var c=new b.Gain(t);return this.bpm.chain(c,u._param),this._syncedSignals.push({ratio:c,signal:u,initial:u._param.value}),u._param.value=0,this},b.Transport.prototype.unsyncSignal=function(b){for(var u=this._syncedSignals.length-1;u>=0;u--){var t=this._syncedSignals[u];t.signal===b&&(t.ratio.dispose(),t.signal._param.value=t.initial,this._syncedSignals.splice(u,1))}return this},b.Transport.prototype.dispose=function(){return b.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._onceEvents.dispose(),this._onceEvents=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var u=b.Transport;return b.Transport=new u,b.Context.on("init",function(t){t.Transport instanceof u?b.Transport=t.Transport:(b.Transport=new u,t.Transport=b.Transport)}),b.Transport}),u(function(b){return b.Volume=function(){var u=this.optionsObject(arguments,["volume"],b.Volume.defaults);this.output=this.input=new b.Gain(u.volume,b.Type.Decibels),this._unmutedVolume=u.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=u.mute},b.extend(b.Volume),b.Volume.defaults={volume:0,mute:!1},Object.defineProperty(b.Volume.prototype,"mute",{get:function(){return this.volume.value===-(1/0)},set:function(b){!this.mute&&b?(this._unmutedVolume=this.volume.value,this.volume.value=-(1/0)):this.mute&&!b&&(this.volume.value=this._unmutedVolume)}}),b.Volume.prototype.dispose=function(){return this.input.dispose(),b.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},b.Volume}),u(function(b){b.Master=function(){this.createInsOuts(1,1),this._volume=this.output=new b.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)},b.extend(b.Master),b.Master.defaults={volume:0,mute:!1},Object.defineProperty(b.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(b){this._volume.mute=b}}),b.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},b.Master.prototype.dispose=function(){b.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},b.prototype.toMaster=function(){return this.connect(b.Master),this},AudioNode.prototype.toMaster=function(){return this.connect(b.Master),this};var u=b.Master;return b.Master=new u,b.Context.on("init",function(t){t.Master instanceof u?b.Master=t.Master:b.Master=new u,t.Master=b.Master}),b.Master}),u(function(b){return b.Source=function(u){u=this.defaultArg(u,b.Source.defaults),this._volume=this.output=new b.Volume(u.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new b.TimelineState(b.State.Stopped),this._state.memory=10,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=u.mute},b.extend(b.Source),b.Source.defaults={volume:0,mute:!1},Object.defineProperty(b.Source.prototype,"state",{get:function(){return this._synced?b.Transport.state===b.State.Started?this._state.getValueAtTime(b.Transport.seconds):b.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(b.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(b){this._volume.mute=b}}),b.Source.prototype._start=b.noOp,b.Source.prototype._stop=b.noOp,b.Source.prototype.start=function(u,t,c){if(u=this.isUndef(u)&&this._synced?b.Transport.seconds:this.toSeconds(u),this.retrigger||this._state.getValueAtTime(u)!==b.State.Started||this.stop(u),this._state.setStateAtTime(b.State.Started,u),this._synced){var h=this._state.get(u);h.offset=this.defaultArg(t,0),h.duration=c;var i=b.Transport.schedule(function(b){this._start(b,t,c)}.bind(this),u);this._scheduled.push(i)}else this._start.apply(this,arguments);return this},b.Source.prototype.stop=function(u){if(u=this.isUndef(u)&&this._synced?b.Transport.seconds:this.toSeconds(u),this._state.cancel(u),this._state.setStateAtTime(b.State.Stopped,u),this._synced){var t=b.Transport.schedule(this._stop.bind(this),u);this._scheduled.push(t)}else this._stop.apply(this,arguments);return this},b.Source.prototype.sync=function(){return this._synced=!0,b.Transport.on("start loopStart",function(u,t){if(t>0){var c=this._state.get(t);if(c&&c.state===b.State.Started&&c.time!==t){var h,i=t-this.toSeconds(c.time);c.duration&&(h=this.toSeconds(c.duration)-i),this._start(u,this.toSeconds(c.offset)+i,h)}}}.bind(this)),b.Transport.on("stop pause loopEnd",function(u){this._state.getValueAtTime(b.Transport.seconds)===b.State.Started&&this._stop(u)}.bind(this)),this},b.Source.prototype.unsync=function(){this._synced=!1,b.Transport.off("start stop pause loopEnd loopStart");for(var u=0;u<this._scheduled.length;u++){var t=this._scheduled[u];b.Transport.clear(t)}return this._scheduled=[],this._state.cancel(0),this},b.Source.prototype.dispose=function(){b.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null},b.Source}),u(function(b){return window.OscillatorNode&&!OscillatorNode.prototype.start&&(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn,OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff,OscillatorNode.prototype.setPeriodicWave||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioContext.prototype.createPeriodicWave||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable)),b.Oscillator=function(){var u=this.optionsObject(arguments,["frequency","type"],b.Oscillator.defaults);b.Source.call(this,u),this._oscillator=null,this.frequency=new b.Signal(u.frequency,b.Type.Frequency),this.detune=new b.Signal(u.detune,b.Type.Cents),this._wave=null,this._partials=this.defaultArg(u.partials,[1]),this._phase=u.phase,this._type=null,this.type=u.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},b.extend(b.Oscillator,b.Source),b.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},b.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},b.Oscillator.prototype._start=function(b){this._oscillator=this.context.createOscillator(),this._oscillator.setPeriodicWave(this._wave),this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(this.toSeconds(b))},b.Oscillator.prototype._stop=function(b){return this._oscillator&&(this._oscillator.stop(this.toSeconds(b)),this._oscillator=null),this},b.Oscillator.prototype.syncFrequency=function(){return b.Transport.syncSignal(this.frequency),this},b.Oscillator.prototype.unsyncFrequency=function(){return b.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(b.Oscillator.prototype,"type",{get:function(){return this._type},set:function(b){var u=this._getRealImaginary(b,this._phase),t=this.context.createPeriodicWave(u[0],u[1]);this._wave=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),this._type=b}}),b.Oscillator.prototype._getRealImaginary=function(u,t){var c=4096,h=c/2,i=new Float32Array(h),bb=new Float32Array(h),ub=1;if(u===b.Oscillator.Type.Custom)ub=this._partials.length+1,h=ub;else{var tb=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(u);tb&&(ub=parseInt(tb[2])+1,u=tb[1],ub=Math.max(ub,2),h=ub)}for(var cb=1;h>cb;++cb){var hb,ib=2/(cb*Math.PI);switch(u){case b.Oscillator.Type.Sine:hb=ub>=cb?1:0;break;case b.Oscillator.Type.Square:hb=1&cb?2*ib:0;break;case b.Oscillator.Type.Sawtooth:hb=ib*(1&cb?1:-1);break;case b.Oscillator.Type.Triangle:hb=1&cb?2*(ib*ib)*(cb-1>>1&1?-1:1):0;break;case b.Oscillator.Type.Custom:hb=this._partials[cb-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+u)}0!==hb?(i[cb]=-hb*Math.sin(t*cb),bb[cb]=hb*Math.cos(t*cb)):(i[cb]=0,bb[cb]=0)}return[i,bb]},b.Oscillator.prototype._inverseFFT=function(b,u,t){for(var c=0,h=b.length,i=0;h>i;i++)c+=b[i]*Math.cos(i*t)+u[i]*Math.sin(i*t);return c},b.Oscillator.prototype._getInitialValue=function(){for(var b=this._getRealImaginary(this._type,0),u=b[0],t=b[1],c=0,h=2*Math.PI,i=0;8>i;i++)c=Math.max(this._inverseFFT(u,t,i/8*h),c);return-this._inverseFFT(u,t,this._phase)/c},Object.defineProperty(b.Oscillator.prototype,"partials",{get:function(){return this._type!==b.Oscillator.Type.Custom?[]:this._partials},set:function(u){this._partials=u,this.type=b.Oscillator.Type.Custom}}),Object.defineProperty(b.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(b){this._phase=b*Math.PI/180,this.type=this._type}}),b.Oscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.disconnect(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},b.Oscillator}),u(function(b){return b.Zero=function(){this._gain=this.input=this.output=new b.Gain,this.context.getConstant(0).connect(this._gain)},b.extend(b.Zero),b.Zero.prototype.dispose=function(){return b.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},b.Zero}),u(function(b){return b.LFO=function(){var u=this.optionsObject(arguments,["frequency","min","max"],b.LFO.defaults);this._oscillator=new b.Oscillator({frequency:u.frequency,type:u.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=b.Type.NormalRange,this.amplitude.value=u.amplitude,this._stoppedSignal=new b.Signal(0,b.Type.AudioRange),this._zeros=new b.Zero,this._stoppedValue=0,this._a2g=new b.AudioToGain,this._scaler=this.output=new b.Scale(u.min,u.max),this._units=b.Type.Default,this.units=u.units,this._oscillator.chain(this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=u.phase},b.extend(b.LFO,b.Oscillator),b.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:b.Type.Default},b.LFO.prototype.start=function(b){return b=this.toSeconds(b),this._stoppedSignal.setValueAtTime(0,b),this._oscillator.start(b),this},b.LFO.prototype.stop=function(b){return b=this.toSeconds(b),this._stoppedSignal.setValueAtTime(this._stoppedValue,b),this._oscillator.stop(b),this},b.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},b.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(b.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(b){b=this._fromUnits(b),this._scaler.min=b}}),Object.defineProperty(b.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(b){b=this._fromUnits(b),this._scaler.max=b}}),Object.defineProperty(b.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(b){this._oscillator.type=b,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(b.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(b){this._oscillator.phase=b,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(b.LFO.prototype,"units",{get:function(){return this._units},set:function(b){var u=this.min,t=this.max;this._units=b,this.min=u,this.max=t}}),Object.defineProperty(b.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(b){this._oscillator.mute=b}}),Object.defineProperty(b.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),b.LFO.prototype.connect=function(u){return(u.constructor===b.Signal||u.constructor===b.Param||u.constructor===b.TimelineSignal)&&(this.convert=u.convert,this.units=u.units),b.Signal.prototype.connect.apply(this,arguments),this},b.LFO.prototype._fromUnits=b.Param.prototype._fromUnits,b.LFO.prototype._toUnits=b.Param.prototype._toUnits,b.LFO.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},b.LFO}),u(function(b){return b.Limiter=function(){var u=this.optionsObject(arguments,["threshold"],b.Limiter.defaults);this._compressor=this.input=this.output=new b.Compressor({attack:.001,decay:.001,threshold:u.threshold}),this.threshold=this._compressor.threshold,this._readOnly("threshold")},b.extend(b.Limiter),b.Limiter.defaults={threshold:-12},b.Limiter.prototype.dispose=function(){return b.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},b.Limiter}),u(function(b){return b.LowpassCombFilter=function(){this.createInsOuts(1,1);var u=this.optionsObject(arguments,["delayTime","resonance","dampening"],b.LowpassCombFilter.defaults);this._delay=this.input=new b.Delay(u.delayTime),this.delayTime=this._delay.delayTime,this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=-3.0102999566398125,this._lowpass.type="lowpass",this.dampening=new b.Param({param:this._lowpass.frequency,units:b.Type.Frequency,value:u.dampening}),this._feedback=new b.Gain(u.resonance,b.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._lowpass,this._feedback,this._delay),this._readOnly(["dampening","resonance","delayTime"])},b.extend(b.LowpassCombFilter),b.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},b.LowpassCombFilter.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},b.LowpassCombFilter}),u(function(b){return b.Merge=function(){this.createInsOuts(2,0),this.left=this.input[0]=new b.Gain,this.right=this.input[1]=new b.Gain,this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},b.extend(b.Merge),b.Merge.prototype.dispose=function(){return b.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},b.Merge}),u(function(b){return b.Meter=function(){var u=this.optionsObject(arguments,["type","smoothing"],b.Meter.defaults);this.type=u.type,this.input=this.output=this._analyser=new b.Analyser("waveform",512),this._analyser.returnType="float",this.smoothing=u.smoothing,this._lastValue=0},b.extend(b.Meter),b.Meter.Type={Level:"level",Signal:"signal"},b.Meter.defaults={smoothing:.8,type:b.Meter.Type.Level},Object.defineProperty(b.Meter.prototype,"value",{get:function(){var u=this._analyser.analyse();if(this.type===b.Meter.Type.Level){for(var t=0,c=0;c<u.length;c++)t+=Math.pow(u[c],2);var h=Math.sqrt(t/u.length);h=Math.max(h,this._lastValue*this.smoothing),this._lastValue=h;var i=.35,bb=h/i;return Math.sqrt(bb)}return u[0]}}),b.Meter.prototype.dispose=function(){return b.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},b.Meter}),u(function(b){return b.Split=function(){this.createInsOuts(0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this.left=this.output[0]=new b.Gain,this.right=this.output[1]=new b.Gain,this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},b.extend(b.Split),b.Split.prototype.dispose=function(){return b.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},b.Split}),u(function(b){return b.MidSideSplit=function(){this.createInsOuts(0,2),this._split=this.input=new b.Split,this.mid=this.output[0]=new b.Expr("($0 + $1) * $2"),this.side=this.output[1]=new b.Expr("($0 - $1) * $2"),this._split.connect(this.mid,0,0),this._split.connect(this.mid,1,1),this._split.connect(this.side,0,0),this._split.connect(this.side,1,1),this.context.getConstant(Math.SQRT1_2).connect(this.mid,0,2),this.context.getConstant(Math.SQRT1_2).connect(this.side,0,2)},b.extend(b.MidSideSplit),b.MidSideSplit.prototype.dispose=function(){return b.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._split.dispose(),this._split=null,this},b.MidSideSplit}),u(function(b){return b.MidSideMerge=function(){this.createInsOuts(2,0),this.mid=this.input[0]=new b.Gain,this._left=new b.Expr("($0 + $1) * $2"),this.side=this.input[1]=new b.Gain,this._right=new b.Expr("($0 - $1) * $2"),this._merge=this.output=new b.Merge,this.mid.connect(this._left,0,0),this.side.connect(this._left,0,1),this.mid.connect(this._right,0,0),this.side.connect(this._right,0,1),this._left.connect(this._merge,0,0),this._right.connect(this._merge,0,1),this.context.getConstant(Math.SQRT1_2).connect(this._left,0,2),this.context.getConstant(Math.SQRT1_2).connect(this._right,0,2)},b.extend(b.MidSideMerge),b.MidSideMerge.prototype.dispose=function(){return b.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._right.dispose(),this._right=null,this._merge.dispose(),this._merge=null,this},b.MidSideMerge}),u(function(b){return b.MidSideCompressor=function(u){u=this.defaultArg(u,b.MidSideCompressor.defaults),this._midSideSplit=this.input=new b.MidSideSplit,this._midSideMerge=this.output=new b.MidSideMerge,this.mid=new b.Compressor(u.mid),this.side=new b.Compressor(u.side),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),this._readOnly(["mid","side"])},b.extend(b.MidSideCompressor),b.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},b.MidSideCompressor.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},b.MidSideCompressor}),u(function(b){return b.Mono=function(){this.createInsOuts(1,0),this._merge=this.output=new b.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1),this.input.gain.value=this.dbToGain(-10)},b.extend(b.Mono),b.Mono.prototype.dispose=function(){return b.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},b.Mono}),u(function(b){return b.MultibandCompressor=function(u){u=this.defaultArg(arguments,b.MultibandCompressor.defaults),this._splitter=this.input=new b.MultibandSplit({lowFrequency:u.lowFrequency,highFrequency:u.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new b.Gain,this.low=new b.Compressor(u.low),this.mid=new b.Compressor(u.mid),this.high=new b.Compressor(u.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},b.extend(b.MultibandCompressor),b.MultibandCompressor.defaults={low:b.Compressor.defaults,mid:b.Compressor.defaults,high:b.Compressor.defaults,lowFrequency:250,highFrequency:2e3},b.MultibandCompressor.prototype.dispose=function(){return b.prototype.dispose.call(this),this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},b.MultibandCompressor}),u(function(b){return b.Panner=function(u){this._hasStereoPanner?(this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan):(this._crossFade=new b.CrossFade,this._merger=this.output=new b.Merge,this._splitter=this.input=new b.Split,this.pan=new b.Signal(0,b.Type.AudioRange),this._zero=new b.Zero,this._a2g=new b.AudioToGain,this._zero.connect(this._a2g),this.pan.chain(this._a2g,this._crossFade.fade),this._splitter.connect(this._crossFade,0,0),this._splitter.connect(this._crossFade,1,1),this._crossFade.a.connect(this._merger,0,0),this._crossFade.b.connect(this._merger,0,1)),this.pan.value=this.defaultArg(u,0),this._readOnly("pan")},b.extend(b.Panner),b.Panner.prototype._hasStereoPanner=b.prototype.isFunction(b.context.createStereoPanner),b.Panner.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable("pan"),this._hasStereoPanner?(this._panner.disconnect(),this._panner=null,this.pan=null):(this._zero.dispose(),this._zero=null,this._crossFade.dispose(),this._crossFade=null,this._splitter.dispose(),this._splitter=null,this._merger.dispose(),this._merger=null,this.pan.dispose(),this.pan=null,this._a2g.dispose(),this._a2g=null),this},b.Panner}),u(function(b){return b.Panner3D=function(){var u=this.optionsObject(arguments,["positionX","positionY","positionZ"],b.Panner3D.defaults);this._panner=this.input=this.output=this.context.createPanner(),this._panner.panningModel=u.panningModel,this._panner.maxDistance=u.maxDistance,this._panner.distanceModel=u.distanceModel,this._panner.coneOuterGain=u.coneOuterGain,this._panner.coneOuterAngle=u.coneOuterAngle,this._panner.coneInnerAngle=u.coneInnerAngle,this._panner.refDistance=u.refDistance,this._panner.rolloffFactor=u.rolloffFactor,this._orientation=[u.orientationX,u.orientationY,u.orientationZ],this._position=[u.positionX,u.positionY,u.positionZ],this.orientationX=u.orientationX,this.orientationY=u.orientationY,this.orientationZ=u.orientationZ,this.positionX=u.positionX,this.positionY=u.positionY,this.positionZ=u.positionZ},b.extend(b.Panner3D),b.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},b.Panner3D.prototype._rampTimeConstant=.01,b.Panner3D.prototype.setPosition=function(b,u,t){if(this._panner.positionX){var c=this.now();this._panner.positionX.setTargetAtTime(b,c,this._rampTimeConstant),this._panner.positionY.setTargetAtTime(u,c,this._rampTimeConstant),this._panner.positionZ.setTargetAtTime(t,c,this._rampTimeConstant)}else this._panner.setPosition(b,u,t);return this._position=Array.prototype.slice.call(arguments),this},b.Panner3D.prototype.setOrientation=function(b,u,t){if(this._panner.orientationX){var c=this.now();this._panner.orientationX.setTargetAtTime(b,c,this._rampTimeConstant),this._panner.orientationY.setTargetAtTime(u,c,this._rampTimeConstant),this._panner.orientationZ.setTargetAtTime(t,c,this._rampTimeConstant)}else this._panner.setOrientation(b,u,t);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(b.Panner3D.prototype,"positionX",{set:function(b){this._position[0]=b,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(b.Panner3D.prototype,"positionY",{set:function(b){this._position[1]=b,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(b.Panner3D.prototype,"positionZ",{set:function(b){this._position[2]=b,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(b.Panner3D.prototype,"orientationX",{set:function(b){this._orientation[0]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(b.Panner3D.prototype,"orientationY",{set:function(b){this._orientation[1]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(b.Panner3D.prototype,"orientationZ",{set:function(b){this._orientation[2]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),b.Panner3D._aliasProperty=function(u){Object.defineProperty(b.Panner3D.prototype,u,{set:function(b){this._panner[u]=b},get:function(){return this._panner[u]}})},b.Panner3D._aliasProperty("panningModel"),b.Panner3D._aliasProperty("refDistance"),b.Panner3D._aliasProperty("rolloffFactor"),b.Panner3D._aliasProperty("distanceModel"),b.Panner3D._aliasProperty("coneInnerAngle"),b.Panner3D._aliasProperty("coneOuterAngle"),b.Panner3D._aliasProperty("coneOuterGain"),b.Panner3D._aliasProperty("maxDistance"),b.Panner3D.prototype.dispose=function(){return this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},b.Panner3D}),u(function(b){return b.PanVol=function(){var u=this.optionsObject(arguments,["pan","volume"],b.PanVol.defaults);this._panner=this.input=new b.Panner(u.pan),this.pan=this._panner.pan,this._volume=this.output=new b.Volume(u.volume),this.volume=this._volume.volume,this._panner.connect(this._volume),this._readOnly(["pan","volume"])},b.extend(b.PanVol),b.PanVol.defaults={pan:.5,volume:0},b.PanVol.prototype.dispose=function(){return b.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},b.PanVol}),u(function(b){return b.CtrlInterpolate=function(){var u=this.optionsObject(arguments,["values","index"],b.CtrlInterpolate.defaults);this.values=u.values,this.index=u.index},b.extend(b.CtrlInterpolate),b.CtrlInterpolate.defaults={index:0,values:[]},Object.defineProperty(b.CtrlInterpolate.prototype,"value",{get:function(){var b=this.index;b=Math.min(b,this.values.length-1);var u=Math.floor(b),t=this.values[u],c=this.values[Math.ceil(b)];return this._interpolate(b-u,t,c)}}),b.CtrlInterpolate.prototype._interpolate=function(b,u,t){if(this.isArray(u)){for(var c=[],h=0;h<u.length;h++)c[h]=this._interpolate(b,u[h],t[h]);return c}if(this.isObject(u)){var i={};for(var bb in u)i[bb]=this._interpolate(b,u[bb],t[bb]);return i}return u=this._toNumber(u),t=this._toNumber(t),(1-b)*u+b*t},b.CtrlInterpolate.prototype._toNumber=function(b){return this.isNumber(b)?b:this.toSeconds(b)},b.CtrlInterpolate.prototype.dispose=function(){this.values=null},b.CtrlInterpolate}),u(function(b){return b.CtrlMarkov=function(b,u){this.values=this.defaultArg(b,{}),this.value=this.defaultArg(u,Object.keys(this.values)[0])},b.extend(b.CtrlMarkov),b.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var b=this.values[this.value];if(this.isArray(b))for(var u=this._getProbDistribution(b),t=Math.random(),c=0,h=0;h<u.length;h++){var i=u[h];if(t>c&&c+i>t){var bb=b[h];this.isObject(bb)?this.value=bb.value:this.value=bb}c+=i}else this.value=b}return this.value},b.CtrlMarkov.prototype._getProbDistribution=function(b){for(var u=[],t=0,c=!1,h=0;h<b.length;h++){var i=b[h];this.isObject(i)?(c=!0,u[h]=i.probability):u[h]=1/b.length,t+=u[h]}if(c)for(var bb=0;bb<u.length;bb++)u[bb]=u[bb]/t;return u},b.CtrlMarkov.prototype.dispose=function(){this.values=null},b.CtrlMarkov}),u(function(b){return b.CtrlPattern=function(){var u=this.optionsObject(arguments,["values","type"],b.CtrlPattern.defaults);this.values=u.values,this.index=0,this._type=null,this._shuffled=null,this._direction=null,this.type=u.type},b.extend(b.CtrlPattern),b.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},b.CtrlPattern.defaults={type:b.CtrlPattern.Type.Up,values:[]},Object.defineProperty(b.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var u=this.values[this.index];return this.type===b.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),u=this.values[this._shuffled[this.index]]),u}}}),Object.defineProperty(b.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(u){this._type=u,this._shuffled=null,this._type===b.CtrlPattern.Type.Up||this._type===b.CtrlPattern.Type.UpDown||this._type===b.CtrlPattern.Type.RandomOnce||this._type===b.CtrlPattern.Type.AlternateUp?this.index=0:(this._type===b.CtrlPattern.Type.Down||this._type===b.CtrlPattern.Type.DownUp||this._type===b.CtrlPattern.Type.AlternateDown)&&(this.index=this.values.length-1),this._type===b.CtrlPattern.Type.UpDown||this._type===b.CtrlPattern.Type.AlternateUp?this._direction=b.CtrlPattern.Type.Up:(this._type===b.CtrlPattern.Type.DownUp||this._type===b.CtrlPattern.Type.AlternateDown)&&(this._direction=b.CtrlPattern.Type.Down),this._type===b.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===b.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),b.CtrlPattern.prototype.next=function(){var u=this.type;return u===b.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):u===b.CtrlPattern.Type.Down?(this.index--,this.index<0&&(this.index=this.values.length-1)):u===b.CtrlPattern.Type.UpDown||u===b.CtrlPattern.Type.DownUp?(this._direction===b.CtrlPattern.Type.Up?this.index++:this.index--,this.index<0?(this.index=1,this._direction=b.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=b.CtrlPattern.Type.Down)):u===b.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):u===b.CtrlPattern.Type.RandomWalk?Math.random()<.5?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,this.values.length-1)):u===b.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):u===b.CtrlPattern.Type.AlternateUp?(this._direction===b.CtrlPattern.Type.Up?(this.index+=2,this._direction=b.CtrlPattern.Type.Down):(this.index-=1,this._direction=b.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=b.CtrlPattern.Type.Up)):u===b.CtrlPattern.Type.AlternateDown&&(this._direction===b.CtrlPattern.Type.Up?(this.index+=1,this._direction=b.CtrlPattern.Type.Down):(this.index-=2,this._direction=b.CtrlPattern.Type.Up),this.index<0&&(this.index=this.values.length-1,this._direction=b.CtrlPattern.Type.Down)),this.value},b.CtrlPattern.prototype._shuffleValues=function(){var b=[];this._shuffled=[];for(var u=0;u<this.values.length;u++)b[u]=u;for(;b.length>0;){var t=b.splice(Math.floor(b.length*Math.random()),1);this._shuffled.push(t[0])}},b.CtrlPattern.prototype.dispose=function(){this._shuffled=null,this.values=null},b.CtrlPattern}),u(function(b){return b.CtrlRandom=function(){var u=this.optionsObject(arguments,["min","max"],b.CtrlRandom.defaults);this.min=u.min,this.max=u.max,this.integer=u.integer},b.extend(b.CtrlRandom),b.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(b.CtrlRandom.prototype,"value",{
get:function(){var b=this.toSeconds(this.min),u=this.toSeconds(this.max),t=Math.random(),c=t*b+(1-t)*u;return this.integer&&(c=Math.floor(c)),c}}),b.CtrlRandom}),u(function(b){return window.AudioBuffer&&!AudioBuffer.prototype.copyToChannel&&(AudioBuffer.prototype.copyToChannel=function(b,u,t){var c=this.getChannelData(u);t=t||0;for(var h=0;h<c.length;h++)c[h+t]=b[h]},AudioBuffer.prototype.copyFromChannel=function(b,u,t){var c=this.getChannelData(u);t=t||0;for(var h=0;h<c.length;h++)b[h]=c[h+t]}),b.Buffer=function(){var u=this.optionsObject(arguments,["url","onload","onerror"],b.Buffer.defaults);this._buffer=null,this._reversed=u.reverse,this._xhr=null,u.url instanceof AudioBuffer||u.url instanceof b.Buffer?(this.set(u.url),u.onload&&u.onload(this)):this.isString(u.url)&&this.load(u.url,u.onload,u.onerror)},b.extend(b.Buffer),b.Buffer.defaults={url:void 0,reverse:!1},b.Buffer.prototype.set=function(u){return u instanceof b.Buffer?this._buffer=u.get():this._buffer=u,this},b.Buffer.prototype.get=function(){return this._buffer},b.Buffer.prototype.load=function(u,t,c){var h=new Promise(function(h,i){this._xhr=b.Buffer.load(u,function(b){this._xhr=null,this.set(b),h(this),t&&t(this)}.bind(this),function(b){this._xhr=null,i(b),c&&c(b)}.bind(this))}.bind(this));return h},b.Buffer.prototype.dispose=function(){return b.Emitter.prototype.dispose.call(this),this._buffer=null,this._xhr&&(b.Buffer._currentDownloads--,this._xhr.abort(),this._xhr=null),this},Object.defineProperty(b.Buffer.prototype,"loaded",{get:function(){return this.length>0}}),Object.defineProperty(b.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(b.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(b.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),b.Buffer.prototype.fromArray=function(b){var u=b[0].length>0,t=u?b.length:1,c=u?b[0].length:b.length,h=this.context.createBuffer(t,c,this.context.sampleRate);u||1!==t||(b=[b]);for(var i=0;t>i;i++)h.copyToChannel(b[i],i);return this._buffer=h,this},b.Buffer.prototype.toMono=function(b){if(this.isNumber(b))this.fromArray(this.toArray(b));else{for(var u=new Float32Array(this.length),t=this.numberOfChannels,c=0;t>c;c++)for(var h=this.toArray(c),i=0;i<h.length;i++)u[i]+=h[i];u=u.map(function(b){return b/t}),this.fromArray(u)}return this},b.Buffer.prototype.toArray=function(b){if(this.isNumber(b))return this.getChannelData(b);if(1===this.numberOfChannels)return this.toArray(0);for(var u=[],t=0;t<this.numberOfChannels;t++)u[t]=this.getChannelData(t);return u},b.Buffer.prototype.getChannelData=function(b){return this._buffer.getChannelData(b)},b.Buffer.prototype.slice=function(u,t){t=this.defaultArg(t,this.duration);for(var c=Math.floor(this.context.sampleRate*this.toSeconds(u)),h=Math.floor(this.context.sampleRate*this.toSeconds(t)),i=[],bb=0;bb<this.numberOfChannels;bb++)i[bb]=this.toArray(bb).slice(c,h);var ub=(new b.Buffer).fromArray(i);return ub},b.Buffer.prototype._reverse=function(){if(this.loaded)for(var b=0;b<this.numberOfChannels;b++)Array.prototype.reverse.call(this.getChannelData(b));return this},Object.defineProperty(b.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(b){this._reversed!==b&&(this._reversed=b,this._reverse())}}),b.Emitter.mixin(b.Buffer),b.Buffer._downloadQueue=[],b.Buffer._currentDownloads=0,b.Buffer.baseUrl="",b.Buffer.load=function(u,t,c){function h(u){if(!c)throw new Error(u);c(u),b.Buffer.emit("error",u)}function i(){for(var u=0,t=0;t<b.Buffer._downloadQueue.length;t++)u+=b.Buffer._downloadQueue[t].progress;b.Buffer.emit("progress",u/b.Buffer._downloadQueue.length)}t=t||b.noOp;var bb=new XMLHttpRequest;return bb.open("GET",b.Buffer.baseUrl+u,!0),bb.responseType="arraybuffer",bb.progress=0,b.Buffer._currentDownloads++,b.Buffer._downloadQueue.push(bb),bb.addEventListener("load",function(){200===bb.status?b.context.decodeAudioData(bb.response,function(u){bb.progress=1,i(),t(u),b.Buffer._currentDownloads--,0===b.Buffer._currentDownloads&&(b.Buffer._downloadQueue=[],b.Buffer.emit("load"))},function(){h("Tone.Buffer: could not decode audio data: "+u)}):h("Tone.Buffer: could not locate file: "+u)}),bb.addEventListener("error",h),bb.addEventListener("progress",function(b){b.lengthComputable&&(bb.progress=b.loaded/b.total*.95,i())}),bb.send(),bb},b.Buffer.cancelDownloads=function(){return b.Buffer._downloadQueue.forEach(function(b){b.abort()}),b.Buffer._currentDownloads=0,b.Buffer},b.Buffer.supportsType=function(b){var u=b.split(".");u=u[u.length-1];var t=document.createElement("audio").canPlayType("audio/"+u);return""!==t},b.loaded=function(){function u(){b.Buffer.off("load",t),b.Buffer.off("error",c)}var t,c;return new Promise(function(u,h){t=function(){u()},c=function(){h()},b.Buffer.on("load",t),b.Buffer.on("error",c)}).then(u)["catch"](function(b){throw u(),new Error(b)})},b.Buffer}),u(function(b){return b.Buffers=function(b,u,t){this._buffers={},this.baseUrl=this.defaultArg(t,""),b=this._flattenUrls(b),this._loadingCount=0;for(var c in b)this._loadingCount++,this.add(c,b[c],this._bufferLoaded.bind(this,u))},b.extend(b.Buffers),b.Buffers.prototype.has=function(b){return this._buffers.hasOwnProperty(b)},b.Buffers.prototype.get=function(b){if(this.has(b))return this._buffers[b];throw new Error("Tone.Buffers: no buffer named "+b)},b.Buffers.prototype._bufferLoaded=function(b){this._loadingCount--,0===this._loadingCount&&b&&b(this)},Object.defineProperty(b.Buffers.prototype,"loaded",{get:function(){var b=!0;for(var u in this._buffers){var t=this.get(u);b=b&&t.loaded}return b}}),b.Buffers.prototype.add=function(u,t,c){return c=this.defaultArg(c,b.noOp),t instanceof b.Buffer?(this._buffers[u]=t,c(this)):t instanceof AudioBuffer?(this._buffers[u]=new b.Buffer(t),c(this)):this.isString(t)&&(this._buffers[u]=new b.Buffer(this.baseUrl+t,c)),this},b.Buffers.prototype._flattenUrls=function(b){var u={};for(var t in b)if(b.hasOwnProperty(t))if(this.isObject(b[t])){var c=this._flattenUrls(b[t]);for(var h in c)c.hasOwnProperty(h)&&(u[t+"."+h]=c[h])}else u[t]=b[t];return u},b.Buffers.prototype.dispose=function(){for(var b in this._buffers)this._buffers[b].dispose();return this._buffers=null,this},b.Buffers}),u(function(b){var u={};return b.prototype.send=function(t,c){u.hasOwnProperty(t)||(u[t]=this.context.createGain()),c=this.defaultArg(c,0);var h=new b.Gain(c,b.Type.Decibels);return this.output.chain(h,u[t]),h},b.prototype.receive=function(b,t){return u.hasOwnProperty(b)||(u[b]=this.context.createGain()),this.isUndef(t)&&(t=this.input),u[b].connect(t),this},b.Context.on("init",function(b){b.Buses?u=b.Buses:(u={},b.Buses=u)}),b}),u(function(b){return b.Draw=function(){this._events=new b.Timeline,this.expiration=.25,this.anticipation=.008,this._boundDrawLoop=this._drawLoop.bind(this)},b.extend(b.Draw),b.Draw.prototype.schedule=function(b,u){return this._events.add({callback:b,time:this.toSeconds(u)}),1===this._events.length&&requestAnimationFrame(this._boundDrawLoop),this},b.Draw.prototype.cancel=function(b){return this._events.cancel(this.toSeconds(b)),this},b.Draw.prototype._drawLoop=function(){for(var u=b.now();this._events.length&&this._events.peek().time-this.anticipation<=u;){var t=this._events.shift();u-t.time<=this.expiration&&t.callback()}this._events.length>0&&requestAnimationFrame(this._boundDrawLoop)},b.Draw=new b.Draw,b.Draw}),u(function(b){b.Listener=function(){var b=this.optionsObject(arguments,["positionX","positionY","positionZ"],u.defaults);this._orientation=[b.forwardX,b.forwardY,b.forwardZ,b.upX,b.upY,b.upZ],this._position=[b.positionX,b.positionY,b.positionZ],this.forwardX=b.forwardX,this.forwardY=b.forwardY,this.forwardZ=b.forwardZ,this.upX=b.upX,this.upY=b.upY,this.upZ=b.upZ,this.positionX=b.positionX,this.positionY=b.positionY,this.positionZ=b.positionZ},b.extend(b.Listener),b.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0},b.Listener.prototype._rampTimeConstant=.01,b.Listener.prototype.setPosition=function(b,u,t){if(this.context.listener.positionX){var c=this.now();this.context.listener.positionX.setTargetAtTime(b,c,this._rampTimeConstant),this.context.listener.positionY.setTargetAtTime(u,c,this._rampTimeConstant),this.context.listener.positionZ.setTargetAtTime(t,c,this._rampTimeConstant)}else this.context.listener.setPosition(b,u,t);return this._position=Array.prototype.slice.call(arguments),this},b.Listener.prototype.setOrientation=function(b,u,t,c,h,i){if(this.context.listener.forwardX){var bb=this.now();this.context.listener.forwardX.setTargetAtTime(b,bb,this._rampTimeConstant),this.context.listener.forwardY.setTargetAtTime(u,bb,this._rampTimeConstant),this.context.listener.forwardZ.setTargetAtTime(t,bb,this._rampTimeConstant),this.context.listener.upX.setTargetAtTime(c,bb,this._rampTimeConstant),this.context.listener.upY.setTargetAtTime(h,bb,this._rampTimeConstant),this.context.listener.upZ.setTargetAtTime(i,bb,this._rampTimeConstant)}else this.context.listener.setOrientation(b,u,t,c,h,i);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(b.Listener.prototype,"positionX",{set:function(b){this._position[0]=b,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(b.Listener.prototype,"positionY",{set:function(b){this._position[1]=b,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(b.Listener.prototype,"positionZ",{set:function(b){this._position[2]=b,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(b.Listener.prototype,"forwardX",{set:function(b){this._orientation[0]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(b.Listener.prototype,"forwardY",{set:function(b){this._orientation[1]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(b.Listener.prototype,"forwardZ",{set:function(b){this._orientation[2]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Object.defineProperty(b.Listener.prototype,"upX",{set:function(b){this._orientation[3]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}}),Object.defineProperty(b.Listener.prototype,"upY",{set:function(b){this._orientation[4]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}}),Object.defineProperty(b.Listener.prototype,"upZ",{set:function(b){this._orientation[5]=b,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}}),b.Listener.prototype.dispose=function(){return this._orientation=null,this._position=null,this};var u=b.Listener;return b.Listener=new u,b.Context.on("init",function(t){t.Listener instanceof u?b.Listener=t.Listener:b.Listener=new u,t.Listener=b.Listener}),b.Listener}),u(function(b){return!window.hasOwnProperty("OfflineAudioContext")&&window.hasOwnProperty("webkitOfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),b.OfflineContext=function(u,t,c){var h=new OfflineAudioContext(u,t*c,c);b.Context.call(this,h),this._duration=t,this._currentTime=0,this.lookAhead=this.blockTime,this.updateInterval=this.blockTime},b.extend(b.OfflineContext,b.Context),b.OfflineContext.prototype.now=function(){return this._currentTime},b.OfflineContext.prototype._createWorker=function(){return{postMessage:function(){}}},b.OfflineContext.prototype.render=function(){for(;this._duration-this._currentTime>=0;)this.emit("tick"),this._currentTime+=b.prototype.blockTime;return new Promise(function(b){this._context.oncomplete=function(u){b(u.renderedBuffer)},this._context.startRendering()}.bind(this))},b.OfflineContext}),u(function(b){return b.Offline=function(u,t){var c=b.context.sampleRate,h=b.context,i=new b.OfflineContext(2,t,c);b.context=i,u(b.Transport);var bb=i.render();return b.context=h,bb.then(function(u){return new b.Buffer(u)})},b.Offline}),u(function(b){return b.Effect=function(){this.createInsOuts(1,1);var u=this.optionsObject(arguments,["wet"],b.Effect.defaults);this._dryWet=new b.CrossFade(u.wet),this.wet=this._dryWet.fade,this.effectSend=new b.Gain,this.effectReturn=new b.Gain,this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},b.extend(b.Effect),b.Effect.defaults={wet:1},b.Effect.prototype.connectEffect=function(b){return this.effectSend.chain(b,this.effectReturn),this},b.Effect.prototype.dispose=function(){return b.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},b.Effect}),u(function(b){return b.AutoFilter=function(){var u=this.optionsObject(arguments,["frequency","baseFrequency","octaves"],b.AutoFilter.defaults);b.Effect.call(this,u),this._lfo=new b.LFO({frequency:u.frequency,amplitude:u.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.filter=new b.Filter(u.filter),this._octaves=0,this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.type=u.type,this._readOnly(["frequency","depth"]),this.octaves=u.octaves,this.baseFrequency=u.baseFrequency},b.extend(b.AutoFilter,b.Effect),b.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},b.AutoFilter.prototype.start=function(b){return this._lfo.start(b),this},b.AutoFilter.prototype.stop=function(b){return this._lfo.stop(b),this},b.AutoFilter.prototype.sync=function(b){return this._lfo.sync(b),this},b.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(b.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(b){this._lfo.type=b}}),Object.defineProperty(b.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(b){this._lfo.min=this.toFrequency(b),this.octaves=this._octaves}}),Object.defineProperty(b.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(b){this._octaves=b,this._lfo.max=this.baseFrequency*Math.pow(2,b)}}),b.AutoFilter.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},b.AutoFilter}),u(function(b){return b.AutoPanner=function(){var u=this.optionsObject(arguments,["frequency"],b.AutoPanner.defaults);b.Effect.call(this,u),this._lfo=new b.LFO({frequency:u.frequency,amplitude:u.depth,min:-1,max:1}),this.depth=this._lfo.amplitude,this._panner=new b.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=u.type,this._readOnly(["depth","frequency"])},b.extend(b.AutoPanner,b.Effect),b.AutoPanner.defaults={frequency:1,type:"sine",depth:1},b.AutoPanner.prototype.start=function(b){return this._lfo.start(b),this},b.AutoPanner.prototype.stop=function(b){return this._lfo.stop(b),this},b.AutoPanner.prototype.sync=function(b){return this._lfo.sync(b),this},b.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(b.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(b){this._lfo.type=b}}),b.AutoPanner.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},b.AutoPanner}),u(function(b){return b.AutoWah=function(){var u=this.optionsObject(arguments,["baseFrequency","octaves","sensitivity"],b.AutoWah.defaults);b.Effect.call(this,u),this.follower=new b.Follower(u.follower),this._sweepRange=new b.ScaleExp(0,1,.5),this._baseFrequency=u.baseFrequency,this._octaves=u.octaves,this._inputBoost=new b.Gain,this._bandpass=new b.Filter({rolloff:-48,frequency:0,Q:u.Q}),this._peaking=new b.Filter(0,"peaking"),this._peaking.gain.value=u.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=u.sensitivity,this._readOnly(["gain","Q"])},b.extend(b.AutoWah,b.Effect),b.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(b.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(b){this._octaves=b,this._setSweepRange()}}),Object.defineProperty(b.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(b){this._baseFrequency=b,this._setSweepRange()}}),Object.defineProperty(b.AutoWah.prototype,"sensitivity",{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(b){this._inputBoost.gain.value=1/this.dbToGain(b)}}),b.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},b.AutoWah.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},b.AutoWah}),u(function(b){return b.BitCrusher=function(){var u=this.optionsObject(arguments,["bits"],b.BitCrusher.defaults);b.Effect.call(this,u);var t=1/Math.pow(2,u.bits-1);this._subtract=new b.Subtract,this._modulo=new b.Modulo(t),this._bits=u.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},b.extend(b.BitCrusher,b.Effect),b.BitCrusher.defaults={bits:4},Object.defineProperty(b.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(b){this._bits=b;var u=1/Math.pow(2,b-1);this._modulo.value=u}}),b.BitCrusher.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},b.BitCrusher}),u(function(b){return b.Chebyshev=function(){var u=this.optionsObject(arguments,["order"],b.Chebyshev.defaults);b.Effect.call(this,u),this._shaper=new b.WaveShaper(4096),this._order=u.order,this.connectEffect(this._shaper),this.order=u.order,this.oversample=u.oversample},b.extend(b.Chebyshev,b.Effect),b.Chebyshev.defaults={order:1,oversample:"none"},b.Chebyshev.prototype._getCoefficient=function(b,u,t){return t.hasOwnProperty(u)?t[u]:(0===u?t[u]=0:1===u?t[u]=b:t[u]=2*b*this._getCoefficient(b,u-1,t)-this._getCoefficient(b,u-2,t),t[u])},Object.defineProperty(b.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(b){this._order=b;for(var u=new Array(4096),t=u.length,c=0;t>c;++c){var h=2*c/t-1;0===h?u[c]=0:u[c]=this._getCoefficient(h,b,{})}this._shaper.curve=u}}),Object.defineProperty(b.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(b){this._shaper.oversample=b}}),b.Chebyshev.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},b.Chebyshev}),u(function(b){return b.StereoEffect=function(){this.createInsOuts(1,1);var u=this.optionsObject(arguments,["wet"],b.Effect.defaults);this._dryWet=new b.CrossFade(u.wet),this.wet=this._dryWet.fade,this._split=new b.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new b.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},b.extend(b.StereoEffect,b.Effect),b.StereoEffect.prototype.dispose=function(){return b.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},b.StereoEffect}),u(function(b){return b.FeedbackEffect=function(){var u=this.optionsObject(arguments,["feedback"]);u=this.defaultArg(u,b.FeedbackEffect.defaults),b.Effect.call(this,u),this._feedbackGain=new b.Gain(u.feedback,b.Type.NormalRange),this.feedback=this._feedbackGain.gain,this.effectReturn.chain(this._feedbackGain,this.effectSend),this._readOnly(["feedback"])},b.extend(b.FeedbackEffect,b.Effect),b.FeedbackEffect.defaults={feedback:.125},b.FeedbackEffect.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},b.FeedbackEffect}),u(function(b){return b.StereoXFeedbackEffect=function(){var u=this.optionsObject(arguments,["feedback"],b.FeedbackEffect.defaults);b.StereoEffect.call(this,u),this.feedback=new b.Signal(u.feedback,b.Type.NormalRange),this._feedbackLR=new b.Gain,this._feedbackRL=new b.Gain,this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},b.extend(b.StereoXFeedbackEffect,b.FeedbackEffect),b.StereoXFeedbackEffect.prototype.dispose=function(){return b.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),this._feedbackRL=null,this},b.StereoXFeedbackEffect}),u(function(b){return b.Chorus=function(){var u=this.optionsObject(arguments,["frequency","delayTime","depth"],b.Chorus.defaults);b.StereoXFeedbackEffect.call(this,u),this._depth=u.depth,this._delayTime=u.delayTime/1e3,this._lfoL=new b.LFO({frequency:u.frequency,min:0,max:1}),this._lfoR=new b.LFO({frequency:u.frequency,min:0,max:1,phase:180}),this._delayNodeL=new b.Delay,this._delayNodeR=new b.Delay,this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=u.frequency,this.type=u.type,this._readOnly(["frequency"]),this.spread=u.spread},b.extend(b.Chorus,b.StereoXFeedbackEffect),b.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine",spread:180},Object.defineProperty(b.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(b){this._depth=b;var u=this._delayTime*b;this._lfoL.min=Math.max(this._delayTime-u,0),this._lfoL.max=this._delayTime+u,this._lfoR.min=Math.max(this._delayTime-u,0),this._lfoR.max=this._delayTime+u}}),Object.defineProperty(b.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(b){this._delayTime=b/1e3,this.depth=this._depth}}),Object.defineProperty(b.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(b){this._lfoL.type=b,this._lfoR.type=b}}),Object.defineProperty(b.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(b){this._lfoL.phase=90-b/2,this._lfoR.phase=b/2+90}}),b.Chorus.prototype.dispose=function(){return b.StereoXFeedbackEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},b.Chorus}),u(function(b){return b.Convolver=function(){var u=this.optionsObject(arguments,["url","onload"],b.Convolver.defaults);b.Effect.call(this,u),this._convolver=this.context.createConvolver(),this._buffer=new b.Buffer,this.isString(u.url)?this._buffer.load(u.url,function(b){this.buffer=b,u.onload()}.bind(this)):u.url&&(this.buffer=u.url,u.onload()),this.connectEffect(this._convolver)},b.extend(b.Convolver,b.Effect),b.Convolver.defaults={onload:b.noOp},Object.defineProperty(b.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(b){this._buffer.set(b),this._convolver.buffer=this._buffer.get()}}),b.Convolver.prototype.load=function(b,u){return this._buffer.load(b,function(b){this.buffer=b,u&&u()}.bind(this))},b.Convolver.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},b.Convolver}),u(function(b){return b.Distortion=function(){var u=this.optionsObject(arguments,["distortion"],b.Distortion.defaults);b.Effect.call(this,u),this._shaper=new b.WaveShaper(4096),this._distortion=u.distortion,this.connectEffect(this._shaper),this.distortion=u.distortion,this.oversample=u.oversample},b.extend(b.Distortion,b.Effect),b.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(b.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(b){this._distortion=b;var u=100*b,t=Math.PI/180;this._shaper.setMap(function(b){return Math.abs(b)<.001?0:(3+u)*b*20*t/(Math.PI+u*Math.abs(b))})}}),Object.defineProperty(b.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(b){this._shaper.oversample=b}}),b.Distortion.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},b.Distortion}),u(function(b){return b.FeedbackDelay=function(){var u=this.optionsObject(arguments,["delayTime","feedback"],b.FeedbackDelay.defaults);b.FeedbackEffect.call(this,u),this._delayNode=new b.Delay(u.delayTime),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),this._readOnly(["delayTime"])},b.extend(b.FeedbackDelay,b.FeedbackEffect),b.FeedbackDelay.defaults={delayTime:.25},b.FeedbackDelay.prototype.dispose=function(){return b.FeedbackEffect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},b.FeedbackDelay}),u(function(b){var u=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],t=[225,556,441,341];return b.Freeverb=function(){var c=this.optionsObject(arguments,["roomSize","dampening"],b.Freeverb.defaults);b.StereoEffect.call(this,c),this.roomSize=new b.Signal(c.roomSize,b.Type.NormalRange),this.dampening=new b.Signal(c.dampening,b.Type.Frequency),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var h=0;h<t.length;h++){var i=this.context.createBiquadFilter();i.type="allpass",i.frequency.value=t[h],this._allpassFiltersL.push(i)}for(var bb=0;bb<t.length;bb++){var ub=this.context.createBiquadFilter();ub.type="allpass",ub.frequency.value=t[bb],this._allpassFiltersR.push(ub)}for(var tb=0;tb<u.length;tb++){var cb=new b.LowpassCombFilter(u[tb]);tb<u.length/2?this.effectSendL.chain(cb,this._allpassFiltersL[0]):this.effectSendR.chain(cb,this._allpassFiltersR[0]),this.roomSize.connect(cb.resonance),this.dampening.connect(cb.dampening),this._combFilters.push(cb)}this.connectSeries.apply(this,this._allpassFiltersL),this.connectSeries.apply(this,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this._readOnly(["roomSize","dampening"])},b.extend(b.Freeverb,b.StereoEffect),b.Freeverb.defaults={roomSize:.7,dampening:3e3},b.Freeverb.prototype.dispose=function(){b.StereoEffect.prototype.dispose.call(this);for(var u=0;u<this._allpassFiltersL.length;u++)this._allpassFiltersL[u].disconnect(),this._allpassFiltersL[u]=null;this._allpassFiltersL=null;for(var t=0;t<this._allpassFiltersR.length;t++)this._allpassFiltersR[t].disconnect(),this._allpassFiltersR[t]=null;this._allpassFiltersR=null;for(var c=0;c<this._combFilters.length;c++)this._combFilters[c].dispose(),this._combFilters[c]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},b.Freeverb}),u(function(b){var u=[.06748,.06404,.08212,.09004],t=[.773,.802,.753,.733],c=[347,113,37];return b.JCReverb=function(){var h=this.optionsObject(arguments,["roomSize"],b.JCReverb.defaults);b.StereoEffect.call(this,h),this.roomSize=new b.Signal(h.roomSize,b.Type.NormalRange),this._scaleRoomSize=new b.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var i=0;i<c.length;i++){var bb=this.context.createBiquadFilter();bb.type="allpass",bb.frequency.value=c[i],this._allpassFilters.push(bb)}for(var ub=0;ub<u.length;ub++){var tb=new b.FeedbackCombFilter(u[ub],.1);this._scaleRoomSize.connect(tb.resonance),tb.resonance.value=t[ub],this._allpassFilters[this._allpassFilters.length-1].connect(tb),ub<u.length/2?tb.connect(this.effectReturnL):tb.connect(this.effectReturnR),this._feedbackCombFilters.push(tb)}this.roomSize.connect(this._scaleRoomSize),this.connectSeries.apply(this,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0]),this._readOnly(["roomSize"])},b.extend(b.JCReverb,b.StereoEffect),b.JCReverb.defaults={roomSize:.5},b.JCReverb.prototype.dispose=function(){b.StereoEffect.prototype.dispose.call(this);for(var u=0;u<this._allpassFilters.length;u++)this._allpassFilters[u].disconnect(),this._allpassFilters[u]=null;this._allpassFilters=null;for(var t=0;t<this._feedbackCombFilters.length;t++)this._feedbackCombFilters[t].dispose(),this._feedbackCombFilters[t]=null;return this._feedbackCombFilters=null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},b.JCReverb}),u(function(b){return b.MidSideEffect=function(){b.Effect.apply(this,arguments),this._midSideSplit=new b.MidSideSplit,this._midSideMerge=new b.MidSideMerge,this.midSend=this._midSideSplit.mid,this.sideSend=this._midSideSplit.side,this.midReturn=this._midSideMerge.mid,this.sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)},b.extend(b.MidSideEffect,b.Effect),b.MidSideEffect.prototype.dispose=function(){return b.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},b.MidSideEffect}),u(function(b){return b.Phaser=function(){var u=this.optionsObject(arguments,["frequency","octaves","baseFrequency"],b.Phaser.defaults);b.StereoEffect.call(this,u),this._lfoL=new b.LFO(u.frequency,0,1),this._lfoR=new b.LFO(u.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=u.baseFrequency,this._octaves=u.octaves,this.Q=new b.Signal(u.Q,b.Type.Positive),this._filtersL=this._makeFilters(u.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(u.stages,this._lfoR,this.Q),
this.frequency=this._lfoL.frequency,this.frequency.value=u.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[u.stages-1].connect(this.effectReturnL),this._filtersR[u.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=u.baseFrequency,this.octaves=u.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},b.extend(b.Phaser,b.StereoEffect),b.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},b.Phaser.prototype._makeFilters=function(b,u,t){for(var c=new Array(b),h=0;b>h;h++){var i=this.context.createBiquadFilter();i.type="allpass",t.connect(i.Q),u.connect(i.frequency),c[h]=i}return this.connectSeries.apply(this,c),c},Object.defineProperty(b.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(b){this._octaves=b;var u=this._baseFrequency*Math.pow(2,b);this._lfoL.max=u,this._lfoR.max=u}}),Object.defineProperty(b.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(b){this._baseFrequency=b,this._lfoL.min=b,this._lfoR.min=b,this.octaves=this._octaves}}),b.Phaser.prototype.dispose=function(){b.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var u=0;u<this._filtersL.length;u++)this._filtersL[u].disconnect(),this._filtersL[u]=null;this._filtersL=null;for(var t=0;t<this._filtersR.length;t++)this._filtersR[t].disconnect(),this._filtersR[t]=null;return this._filtersR=null,this.frequency=null,this},b.Phaser}),u(function(b){return b.PingPongDelay=function(){var u=this.optionsObject(arguments,["delayTime","feedback"],b.PingPongDelay.defaults);b.StereoXFeedbackEffect.call(this,u),this._leftDelay=new b.Delay(0,u.maxDelayTime),this._rightDelay=new b.Delay(0,u.maxDelayTime),this._rightPreDelay=new b.Delay(0,u.maxDelayTime),this.delayTime=new b.Signal(u.delayTime,b.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},b.extend(b.PingPongDelay,b.StereoXFeedbackEffect),b.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},b.PingPongDelay.prototype.dispose=function(){return b.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},b.PingPongDelay}),u(function(b){return b.PitchShift=function(){var u=this.optionsObject(arguments,["pitch"],b.PitchShift.defaults);b.FeedbackEffect.call(this,u),this._frequency=new b.Signal(0),this._delayA=new b.Delay(0,1),this._lfoA=new b.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new b.Delay(0,1),this._lfoB=new b.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new b.CrossFade,this._crossFadeLFO=new b.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new b.Delay(u.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=u.pitch,this._windowSize=u.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var t=this.now();this._lfoA.start(t),this._lfoB.start(t),this._crossFadeLFO.start(t),this.windowSize=this._windowSize},b.extend(b.PitchShift,b.FeedbackEffect),b.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(b.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(b){this._pitch=b;var u=0;0>b?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,u=this.intervalToFrequencyRatio(b-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,u=this.intervalToFrequencyRatio(b)-1),this._frequency.value=u*(1.2/this._windowSize)}}),Object.defineProperty(b.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(b){this._windowSize=this.toSeconds(b),this.pitch=this._pitch}}),b.PitchShift.prototype.dispose=function(){return b.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},b.PitchShift}),u(function(b){return b.StereoFeedbackEffect=function(){var u=this.optionsObject(arguments,["feedback"],b.FeedbackEffect.defaults);b.StereoEffect.call(this,u),this.feedback=new b.Signal(u.feedback,b.Type.NormalRange),this._feedbackL=new b.Gain,this._feedbackR=new b.Gain,this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),this._readOnly(["feedback"])},b.extend(b.StereoFeedbackEffect,b.FeedbackEffect),b.StereoFeedbackEffect.prototype.dispose=function(){return b.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},b.StereoFeedbackEffect}),u(function(b){return b.StereoWidener=function(){var u=this.optionsObject(arguments,["width"],b.StereoWidener.defaults);b.MidSideEffect.call(this,u),this.width=new b.Signal(u.width,b.Type.NormalRange),this._midMult=new b.Expr("$0 * ($1 * (1 - $2))"),this._sideMult=new b.Expr("$0 * ($1 * $2)"),this._two=new b.Signal(2),this._two.connect(this._midMult,0,1),this.width.connect(this._midMult,0,2),this._two.connect(this._sideMult,0,1),this.width.connect(this._sideMult,0,2),this.midSend.chain(this._midMult,this.midReturn),this.sideSend.chain(this._sideMult,this.sideReturn),this._readOnly(["width"])},b.extend(b.StereoWidener,b.MidSideEffect),b.StereoWidener.defaults={width:.5},b.StereoWidener.prototype.dispose=function(){return b.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._two.dispose(),this._two=null,this},b.StereoWidener}),u(function(b){return b.Tremolo=function(){var u=this.optionsObject(arguments,["frequency","depth"],b.Tremolo.defaults);b.StereoEffect.call(this,u),this._lfoL=new b.LFO({phase:u.spread,min:1,max:0}),this._lfoR=new b.LFO({phase:u.spread,min:1,max:0}),this._amplitudeL=new b.Gain,this._amplitudeR=new b.Gain,this.frequency=new b.Signal(u.frequency,b.Type.Frequency),this.depth=new b.Signal(u.depth,b.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=u.type,this.spread=u.spread},b.extend(b.Tremolo,b.StereoEffect),b.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},b.Tremolo.prototype.start=function(b){return this._lfoL.start(b),this._lfoR.start(b),this},b.Tremolo.prototype.stop=function(b){return this._lfoL.stop(b),this._lfoR.stop(b),this},b.Tremolo.prototype.sync=function(b){return this._lfoL.sync(b),this._lfoR.sync(b),this},b.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),this},Object.defineProperty(b.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(b){this._lfoL.type=b,this._lfoR.type=b}}),Object.defineProperty(b.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(b){this._lfoL.phase=90-b/2,this._lfoR.phase=b/2+90}}),b.Tremolo.prototype.dispose=function(){return b.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},b.Tremolo}),u(function(b){return b.Vibrato=function(){var u=this.optionsObject(arguments,["frequency","depth"],b.Vibrato.defaults);b.Effect.call(this,u),this._delayNode=new b.Delay(0,u.maxDelay),this._lfo=new b.LFO({type:u.type,min:0,max:u.maxDelay,frequency:u.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=u.depth,this._readOnly(["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)},b.extend(b.Vibrato,b.Effect),b.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(b.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(b){this._lfo.type=b}}),b.Vibrato.prototype.dispose=function(){b.Effect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._lfo.dispose(),this._lfo=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null},b.Vibrato}),u(function(b){return b.Event=function(){var u=this.optionsObject(arguments,["callback","value"],b.Event.defaults);this._loop=u.loop,this.callback=u.callback,this.value=u.value,this._loopStart=this.toTicks(u.loopStart),this._loopEnd=this.toTicks(u.loopEnd),this._state=new b.TimelineState(b.State.Stopped),this._playbackRate=1,this._startOffset=0,this.probability=u.probability,this.humanize=u.humanize,this.mute=u.mute,this.playbackRate=u.playbackRate},b.extend(b.Event),b.Event.defaults={callback:b.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},b.Event.prototype._rescheduleEvents=function(u){return u=this.defaultArg(u,-1),this._state.forEachFrom(u,function(u){var t;if(u.state===b.State.Started){this.isUndef(u.id)||b.Transport.clear(u.id);var c=u.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){t=1/0,this.isNumber(this._loop)&&(t=this._loop*this._getLoopDuration());var h=this._state.getAfter(c);null!==h&&(t=Math.min(t,h.time-c)),t!==1/0&&(this._state.setStateAtTime(b.State.Stopped,c+t+1),t=b.Time(t,"i"));var i=b.Time(this._getLoopDuration(),"i");u.id=b.Transport.scheduleRepeat(this._tick.bind(this),i,b.TransportTime(c,"i"),t)}else u.id=b.Transport.schedule(this._tick.bind(this),c+"i")}}.bind(this)),this},Object.defineProperty(b.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(b.Transport.ticks)}}),Object.defineProperty(b.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(b){this._startOffset=b}}),b.Event.prototype.start=function(u){return u=this.toTicks(u),this._state.getValueAtTime(u)===b.State.Stopped&&(this._state.add({state:b.State.Started,time:u,id:void 0}),this._rescheduleEvents(u)),this},b.Event.prototype.stop=function(u){if(this.cancel(u),u=this.toTicks(u),this._state.getValueAtTime(u)===b.State.Started){this._state.setStateAtTime(b.State.Stopped,u);var t=this._state.getBefore(u),c=u;null!==t&&(c=t.time),this._rescheduleEvents(c)}return this},b.Event.prototype.cancel=function(u){return u=this.defaultArg(u,-(1/0)),u=this.toTicks(u),this._state.forEachFrom(u,function(u){b.Transport.clear(u.id)}),this._state.cancel(u),this},b.Event.prototype._tick=function(u){if(!this.mute&&this._state.getValueAtTime(b.Transport.ticks)===b.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var t=.02;this.isBoolean(this.humanize)||(t=this.toSeconds(this.humanize)),u+=(2*Math.random()-1)*t}this.callback(u,this.value)}},b.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(b.Event.prototype,"loop",{get:function(){return this._loop},set:function(b){this._loop=b,this._rescheduleEvents()}}),Object.defineProperty(b.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(b){this._playbackRate=b,this._rescheduleEvents()}}),Object.defineProperty(b.Event.prototype,"loopEnd",{get:function(){return b.TransportTime(this._loopEnd,"i").toNotation()},set:function(b){this._loopEnd=this.toTicks(b),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(b.Event.prototype,"loopStart",{get:function(){return b.TransportTime(this._loopStart,"i").toNotation()},set:function(b){this._loopStart=this.toTicks(b),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(b.Event.prototype,"progress",{get:function(){if(this._loop){var u=b.Transport.ticks,t=this._state.get(u);if(null!==t&&t.state===b.State.Started){var c=this._getLoopDuration(),h=(u-t.time)%c;return h/c}return 0}return 0}}),b.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},b.Event}),u(function(b){return b.Loop=function(){var u=this.optionsObject(arguments,["callback","interval"],b.Loop.defaults);this._event=new b.Event({callback:this._tick.bind(this),loop:!0,loopEnd:u.interval,playbackRate:u.playbackRate,probability:u.probability}),this.callback=u.callback,this.iterations=u.iterations},b.extend(b.Loop),b.Loop.defaults={interval:"4n",callback:b.noOp,playbackRate:1,iterations:1/0,probability:!0,mute:!1},b.Loop.prototype.start=function(b){return this._event.start(b),this},b.Loop.prototype.stop=function(b){return this._event.stop(b),this},b.Loop.prototype.cancel=function(b){return this._event.cancel(b),this},b.Loop.prototype._tick=function(b){this.callback(b)},Object.defineProperty(b.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(b.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(b.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(b){this._event.loopEnd=b}}),Object.defineProperty(b.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(b){this._event.playbackRate=b}}),Object.defineProperty(b.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(b){this._event.humanize=b}}),Object.defineProperty(b.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(b){this._event.probability=b}}),Object.defineProperty(b.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(b){this._event.mute=b}}),Object.defineProperty(b.Loop.prototype,"iterations",{get:function(){return this._event.loop===!0?1/0:this._event.loop},set:function(b){b===1/0?this._event.loop=!0:this._event.loop=b}}),b.Loop.prototype.dispose=function(){this._event.dispose(),this._event=null,this.callback=null},b.Loop}),u(function(b){return b.Part=function(){var u=this.optionsObject(arguments,["callback","events"],b.Part.defaults);this._loop=u.loop,this._loopStart=this.toTicks(u.loopStart),this._loopEnd=this.toTicks(u.loopEnd),this._playbackRate=u.playbackRate,this._probability=u.probability,this._humanize=u.humanize,this._startOffset=0,this._state=new b.TimelineState(b.State.Stopped),this._events=[],this.callback=u.callback,this.mute=u.mute;var t=this.defaultArg(u.events,[]);if(!this.isUndef(u.events))for(var c=0;c<t.length;c++)Array.isArray(t[c])?this.add(t[c][0],t[c][1]):this.add(t[c])},b.extend(b.Part,b.Event),b.Part.defaults={callback:b.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1},b.Part.prototype.start=function(u,t){var c=this.toTicks(u);return this._state.getValueAtTime(c)!==b.State.Started&&(t=this._loop?this.defaultArg(t,this._loopStart):this.defaultArg(t,0),t=this.toTicks(t),this._state.add({state:b.State.Started,time:c,offset:t}),this._forEach(function(b){this._startNote(b,c,t)})),this},b.Part.prototype._startNote=function(u,t,c){t-=c,this._loop?u.startOffset>=this._loopStart&&u.startOffset<this._loopEnd?(u.startOffset<c&&(t+=this._getLoopDuration()),u.start(b.TransportTime(t,"i"))):u.startOffset<this._loopStart&&u.startOffset>=c&&(u.loop=!1,u.start(b.TransportTime(t,"i"))):u.startOffset>=c&&u.start(b.TransportTime(t,"i"))},Object.defineProperty(b.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(b){this._startOffset=b,this._forEach(function(b){b.startOffset+=this._startOffset})}}),b.Part.prototype.stop=function(u){var t=this.toTicks(u);return this._state.cancel(t),this._state.setStateAtTime(b.State.Stopped,t),this._forEach(function(b){b.stop(u)}),this},b.Part.prototype.at=function(u,t){u=b.TransportTime(u);for(var c=b.Time(1,"i").toSeconds(),h=0;h<this._events.length;h++){var i=this._events[h];if(Math.abs(u.toTicks()-i.startOffset)<c)return this.isUndef(t)||(i.value=t),i}return this.isUndef(t)?null:(this.add(u,t),this._events[this._events.length-1])},b.Part.prototype.add=function(u,t){u.hasOwnProperty("time")&&(t=u,u=t.time),u=this.toTicks(u);var c;return t instanceof b.Event?(c=t,c.callback=this._tick.bind(this)):c=new b.Event({callback:this._tick.bind(this),value:t}),c.startOffset=u,c.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(c),this._restartEvent(c),this},b.Part.prototype._restartEvent=function(u){this._state.forEach(function(t){t.state===b.State.Started?this._startNote(u,t.time,t.offset):u.stop(b.TransportTime(t.time,"i"))}.bind(this))},b.Part.prototype.remove=function(u,t){u.hasOwnProperty("time")&&(t=u,u=t.time),u=this.toTicks(u);for(var c=this._events.length-1;c>=0;c--){var h=this._events[c];h instanceof b.Part?h.remove(u,t):h.startOffset===u&&(this.isUndef(t)||!this.isUndef(t)&&h.value===t)&&(this._events.splice(c,1),h.dispose())}return this},b.Part.prototype.removeAll=function(){return this._forEach(function(b){b.dispose()}),this._events=[],this},b.Part.prototype.cancel=function(b){return b=this.toTicks(b),this._forEach(function(u){u.cancel(b)}),this._state.cancel(b),this},b.Part.prototype._forEach=function(u,t){t=this.defaultArg(t,this);for(var c=this._events.length-1;c>=0;c--){var h=this._events[c];h instanceof b.Part?h._forEach(u,t):u.call(t,h)}return this},b.Part.prototype._setAll=function(b,u){this._forEach(function(t){t[b]=u})},b.Part.prototype._tick=function(b,u){this.mute||this.callback(b,u)},b.Part.prototype._testLoopBoundries=function(u){u.startOffset<this._loopStart||u.startOffset>=this._loopEnd?u.cancel(0):u.state===b.State.Stopped&&this._restartEvent(u)},Object.defineProperty(b.Part.prototype,"probability",{get:function(){return this._probability},set:function(b){this._probability=b,this._setAll("probability",b)}}),Object.defineProperty(b.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(b){this._humanize=b,this._setAll("humanize",b)}}),Object.defineProperty(b.Part.prototype,"loop",{get:function(){return this._loop},set:function(b){this._loop=b,this._forEach(function(u){u._loopStart=this._loopStart,u._loopEnd=this._loopEnd,u.loop=b,this._testLoopBoundries(u)})}}),Object.defineProperty(b.Part.prototype,"loopEnd",{get:function(){return b.TransportTime(this._loopEnd,"i").toNotation()},set:function(b){this._loopEnd=this.toTicks(b),this._loop&&this._forEach(function(u){u.loopEnd=b,this._testLoopBoundries(u)})}}),Object.defineProperty(b.Part.prototype,"loopStart",{get:function(){return b.TransportTime(this._loopStart,"i").toNotation()},set:function(b){this._loopStart=this.toTicks(b),this._loop&&this._forEach(function(b){b.loopStart=this.loopStart,this._testLoopBoundries(b)})}}),Object.defineProperty(b.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(b){this._playbackRate=b,this._setAll("playbackRate",b)}}),Object.defineProperty(b.Part.prototype,"length",{get:function(){return this._events.length}}),b.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},b.Part}),u(function(b){return b.Pattern=function(){var u=this.optionsObject(arguments,["callback","values","pattern"],b.Pattern.defaults);b.Loop.call(this,u),this._pattern=new b.CtrlPattern({values:u.values,type:u.pattern,index:u.index})},b.extend(b.Pattern,b.Loop),b.Pattern.defaults={pattern:b.CtrlPattern.Type.Up,values:[]},b.Pattern.prototype._tick=function(b){this.callback(b,this._pattern.value),this._pattern.next()},Object.defineProperty(b.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(b){this._pattern.index=b}}),Object.defineProperty(b.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(b){this._pattern.values=b}}),Object.defineProperty(b.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(b.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(b){this._pattern.type=b}}),b.Pattern.prototype.dispose=function(){b.Loop.prototype.dispose.call(this),this._pattern.dispose(),this._pattern=null},b.Pattern}),u(function(b){return b.Sequence=function(){var u=this.optionsObject(arguments,["callback","events","subdivision"],b.Sequence.defaults),t=u.events;if(delete u.events,b.Part.call(this,u),this._subdivision=this.toTicks(u.subdivision),this.isUndef(u.loopEnd)&&!this.isUndef(t)&&(this._loopEnd=t.length*this._subdivision),this._loop=!0,!this.isUndef(t))for(var c=0;c<t.length;c++)this.add(c,t[c])},b.extend(b.Sequence,b.Part),b.Sequence.defaults={subdivision:"4n"},Object.defineProperty(b.Sequence.prototype,"subdivision",{get:function(){return b.Time(this._subdivision,"i").toNotation()}}),b.Sequence.prototype.at=function(u,t){return this.isArray(t)&&this.remove(u),b.Part.prototype.at.call(this,this._indexTime(u),t)},b.Sequence.prototype.add=function(u,t){if(null===t)return this;if(this.isArray(t)){var c=Math.round(this._subdivision/t.length);t=new b.Sequence(this._tick.bind(this),t,b.Time(c,"i"))}return b.Part.prototype.add.call(this,this._indexTime(u),t),this},b.Sequence.prototype.remove=function(u,t){return b.Part.prototype.remove.call(this,this._indexTime(u),t),this},b.Sequence.prototype._indexTime=function(u){return u instanceof b.TransportTime?u:b.TransportTime(u*this._subdivision+this.startOffset,"i")},b.Sequence.prototype.dispose=function(){return b.Part.prototype.dispose.call(this),this},b.Sequence}),u(function(b){return b.PulseOscillator=function(){var u=this.optionsObject(arguments,["frequency","width"],b.Oscillator.defaults);b.Source.call(this,u),this.width=new b.Signal(u.width,b.Type.NormalRange),this._widthGate=new b.Gain,this._sawtooth=new b.Oscillator({frequency:u.frequency,detune:u.detune,type:"sawtooth",phase:u.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new b.WaveShaper(function(b){return 0>b?-1:1}),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},b.extend(b.PulseOscillator,b.Oscillator),b.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},b.PulseOscillator.prototype._start=function(b){b=this.toSeconds(b),this._sawtooth.start(b),this._widthGate.gain.setValueAtTime(1,b)},b.PulseOscillator.prototype._stop=function(b){b=this.toSeconds(b),this._sawtooth.stop(b),this._widthGate.gain.setValueAtTime(0,b)},Object.defineProperty(b.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(b){this._sawtooth.phase=b}}),Object.defineProperty(b.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(b.PulseOscillator.prototype,"partials",{get:function(){return[]}}),b.PulseOscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},b.PulseOscillator}),u(function(b){return b.PWMOscillator=function(){var u=this.optionsObject(arguments,["frequency","modulationFrequency"],b.PWMOscillator.defaults);b.Source.call(this,u),this._pulse=new b.PulseOscillator(u.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new b.Oscillator({frequency:u.frequency,detune:u.detune,phase:u.phase}),this._scale=new b.Multiply(2),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},b.extend(b.PWMOscillator,b.Oscillator),b.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},b.PWMOscillator.prototype._start=function(b){b=this.toSeconds(b),this._modulator.start(b),this._pulse.start(b)},b.PWMOscillator.prototype._stop=function(b){b=this.toSeconds(b),this._modulator.stop(b),this._pulse.stop(b)},Object.defineProperty(b.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(b.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(b.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(b){this._modulator.phase=b}}),b.PWMOscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},b.PWMOscillator}),u(function(b){return b.FMOscillator=function(){var u=this.optionsObject(arguments,["frequency","type","modulationType"],b.FMOscillator.defaults);b.Source.call(this,u),this._carrier=new b.Oscillator(u.frequency,u.type),this.frequency=new b.Signal(u.frequency,b.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=u.detune,this.modulationIndex=new b.Multiply(u.modulationIndex),this.modulationIndex.units=b.Type.Positive,this._modulator=new b.Oscillator(u.frequency,u.modulationType),this.harmonicity=new b.Multiply(u.harmonicity),this.harmonicity.units=b.Type.Positive,this._modulationNode=new b.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=u.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},b.extend(b.FMOscillator,b.Oscillator),b.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},b.FMOscillator.prototype._start=function(b){b=this.toSeconds(b),this._modulator.start(b),this._carrier.start(b)},b.FMOscillator.prototype._stop=function(b){b=this.toSeconds(b),this._modulator.stop(b),this._carrier.stop(b)},Object.defineProperty(b.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(b){this._carrier.type=b}}),Object.defineProperty(b.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(b){this._modulator.type=b}}),Object.defineProperty(b.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(b){this._carrier.phase=b,this._modulator.phase=b}}),Object.defineProperty(b.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(b){this._carrier.partials=b}}),b.FMOscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},b.FMOscillator}),u(function(b){return b.AMOscillator=function(){var u=this.optionsObject(arguments,["frequency","type","modulationType"],b.AMOscillator.defaults);b.Source.call(this,u),this._carrier=new b.Oscillator(u.frequency,u.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=u.detune,this._modulator=new b.Oscillator(u.frequency,u.modulationType),this._modulationScale=new b.AudioToGain,this.harmonicity=new b.Multiply(u.harmonicity),this.harmonicity.units=b.Type.Positive,this._modulationNode=new b.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=u.phase,this._readOnly(["frequency","detune","harmonicity"])},b.extend(b.AMOscillator,b.Oscillator),b.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},b.AMOscillator.prototype._start=function(b){b=this.toSeconds(b),this._modulator.start(b),this._carrier.start(b)},b.AMOscillator.prototype._stop=function(b){b=this.toSeconds(b),this._modulator.stop(b),this._carrier.stop(b)},Object.defineProperty(b.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(b){this._carrier.type=b}}),Object.defineProperty(b.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(b){this._modulator.type=b}}),Object.defineProperty(b.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(b){this._carrier.phase=b,this._modulator.phase=b}}),Object.defineProperty(b.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(b){this._carrier.partials=b}}),b.AMOscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},b.AMOscillator}),u(function(b){return b.FatOscillator=function(){var u=this.optionsObject(arguments,["frequency","type","spread"],b.FatOscillator.defaults);b.Source.call(this,u),this.frequency=new b.Signal(u.frequency,b.Type.Frequency),this.detune=new b.Signal(u.detune,b.Type.Cents),this._oscillators=[],this._spread=u.spread,this._type=u.type,this._phase=u.phase,this._partials=this.defaultArg(u.partials,[]),this.count=u.count,this._readOnly(["frequency","detune"])},b.extend(b.FatOscillator,b.Oscillator),b.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},b.FatOscillator.prototype._start=function(b){b=this.toSeconds(b),this._forEach(function(u){u.start(b)})},b.FatOscillator.prototype._stop=function(b){
b=this.toSeconds(b),this._forEach(function(u){u.stop(b)})},b.FatOscillator.prototype._forEach=function(b){for(var u=0;u<this._oscillators.length;u++)b.call(this,this._oscillators[u],u)},Object.defineProperty(b.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(b){this._type=b,this._forEach(function(u){u.type=b})}}),Object.defineProperty(b.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(b){if(this._spread=b,this._oscillators.length>1){var u=-b/2,t=b/(this._oscillators.length-1);this._forEach(function(b,c){b.detune.value=u+t*c})}}}),Object.defineProperty(b.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(u){if(u=Math.max(u,1),this._oscillators.length!==u){this._forEach(function(b){b.dispose()}),this._oscillators=[];for(var t=0;u>t;t++){var c=new b.Oscillator;this.type===b.Oscillator.Type.Custom?c.partials=this._partials:c.type=this._type,c.phase=this._phase,c.volume.value=-6-u,this.frequency.connect(c.frequency),this.detune.connect(c.detune),c.connect(this.output),this._oscillators[t]=c}this.spread=this._spread,this.state===b.State.Started&&this._forEach(function(b){b.start()})}}}),Object.defineProperty(b.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(b){this._phase=b,this._forEach(function(u){u.phase=b})}}),Object.defineProperty(b.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(u){this._partials=u,this._type=b.Oscillator.Type.Custom,this._forEach(function(b){b.partials=u})}}),b.FatOscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach(function(b){b.dispose()}),this._oscillators=null,this._partials=null,this},b.FatOscillator}),u(function(b){b.OmniOscillator=function(){var u=this.optionsObject(arguments,["frequency","type"],b.OmniOscillator.defaults);b.Source.call(this,u),this.frequency=new b.Signal(u.frequency,b.Type.Frequency),this.detune=new b.Signal(u.detune,b.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=u.type,this._readOnly(["frequency","detune"]),this.set(u)},b.extend(b.OmniOscillator,b.Oscillator),b.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var u={Pulse:"PulseOscillator",PWM:"PWMOscillator",Osc:"Oscillator",FM:"FMOscillator",AM:"AMOscillator",Fat:"FatOscillator"};return b.OmniOscillator.prototype._start=function(b){this._oscillator.start(b)},b.OmniOscillator.prototype._stop=function(b){this._oscillator.stop(b)},Object.defineProperty(b.OmniOscillator.prototype,"type",{get:function(){var b="";return this._sourceType===u.FM?b="fm":this._sourceType===u.AM?b="am":this._sourceType===u.Fat&&(b="fat"),b+this._oscillator.type},set:function(b){"fm"===b.substr(0,2)?(this._createNewOscillator(u.FM),this._oscillator.type=b.substr(2)):"am"===b.substr(0,2)?(this._createNewOscillator(u.AM),this._oscillator.type=b.substr(2)):"fat"===b.substr(0,3)?(this._createNewOscillator(u.Fat),this._oscillator.type=b.substr(3)):"pwm"===b?this._createNewOscillator(u.PWM):"pulse"===b?this._createNewOscillator(u.Pulse):(this._createNewOscillator(u.Osc),this._oscillator.type=b)}}),Object.defineProperty(b.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(b){this._oscillator.partials=b}}),b.OmniOscillator.prototype.set=function(u,t){return"type"===u?this.type=t:this.isObject(u)&&u.hasOwnProperty("type")&&(this.type=u.type),b.prototype.set.apply(this,arguments),this},b.OmniOscillator.prototype._createNewOscillator=function(u){if(u!==this._sourceType){this._sourceType=u;var t=b[u],c=this.now()+this.blockTime;if(null!==this._oscillator){var h=this._oscillator;h.stop(c),setTimeout(function(){h.dispose(),h=null},1e3*this.blockTime)}this._oscillator=new t,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===b.State.Started&&this._oscillator.start(c)}},Object.defineProperty(b.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(b){this._oscillator.phase=b}}),Object.defineProperty(b.OmniOscillator.prototype,"width",{get:function(){return this._sourceType===u.Pulse?this._oscillator.width:void 0}}),Object.defineProperty(b.OmniOscillator.prototype,"count",{get:function(){return this._sourceType===u.Fat?this._oscillator.count:void 0},set:function(b){this._sourceType===u.Fat&&(this._oscillator.count=b)}}),Object.defineProperty(b.OmniOscillator.prototype,"spread",{get:function(){return this._sourceType===u.Fat?this._oscillator.spread:void 0},set:function(b){this._sourceType===u.Fat&&(this._oscillator.spread=b)}}),Object.defineProperty(b.OmniOscillator.prototype,"modulationType",{get:function(){return this._sourceType===u.FM||this._sourceType===u.AM?this._oscillator.modulationType:void 0},set:function(b){(this._sourceType===u.FM||this._sourceType===u.AM)&&(this._oscillator.modulationType=b)}}),Object.defineProperty(b.OmniOscillator.prototype,"modulationIndex",{get:function(){return this._sourceType===u.FM?this._oscillator.modulationIndex:void 0}}),Object.defineProperty(b.OmniOscillator.prototype,"harmonicity",{get:function(){return this._sourceType===u.FM||this._sourceType===u.AM?this._oscillator.harmonicity:void 0}}),Object.defineProperty(b.OmniOscillator.prototype,"modulationFrequency",{get:function(){return this._sourceType===u.PWM?this._oscillator.modulationFrequency:void 0}}),b.OmniOscillator.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},b.OmniOscillator}),u(function(b){return b.Instrument=function(u){u=this.defaultArg(u,b.Instrument.defaults),this._volume=this.output=new b.Volume(u.volume),this.volume=this._volume.volume,this._readOnly("volume")},b.extend(b.Instrument),b.Instrument.defaults={volume:0},b.Instrument.prototype.triggerAttack=b.noOp,b.Instrument.prototype.triggerRelease=b.noOp,b.Instrument.prototype.triggerAttackRelease=function(b,u,t,c){return t=this.isUndef(t)?this.now()+this.blockTime:this.toSeconds(t),u=this.toSeconds(u),this.triggerAttack(b,t,c),this.triggerRelease(t+u),this},b.Instrument.prototype.dispose=function(){return b.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this},b.Instrument}),u(function(b){return b.Monophonic=function(u){u=this.defaultArg(u,b.Monophonic.defaults),b.Instrument.call(this,u),this.portamento=u.portamento},b.extend(b.Monophonic,b.Instrument),b.Monophonic.defaults={portamento:0},b.Monophonic.prototype.triggerAttack=function(b,u,t){return u=this.isUndef(u)?this.now()+this.blockTime:this.toSeconds(u),this._triggerEnvelopeAttack(u,t),this.setNote(b,u),this},b.Monophonic.prototype.triggerRelease=function(b){return b=this.isUndef(b)?this.now()+this.blockTime:this.toSeconds(b),this._triggerEnvelopeRelease(b),this},b.Monophonic.prototype._triggerEnvelopeAttack=function(){},b.Monophonic.prototype._triggerEnvelopeRelease=function(){},b.Monophonic.prototype.setNote=function(b,u){if(u=this.toSeconds(u),this.portamento>0){var t=this.frequency.value;this.frequency.setValueAtTime(t,u);var c=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(b,u+c)}else this.frequency.setValueAtTime(b,u);return this},b.Monophonic}),u(function(b){return b.Synth=function(u){u=this.defaultArg(u,b.Synth.defaults),b.Monophonic.call(this,u),this.oscillator=new b.OmniOscillator(u.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new b.AmplitudeEnvelope(u.envelope),this.oscillator.chain(this.envelope,this.output),this.oscillator.start(),this._readOnly(["oscillator","frequency","detune","envelope"])},b.extend(b.Synth,b.Monophonic),b.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},b.Synth.prototype._triggerEnvelopeAttack=function(b,u){return this.envelope.triggerAttack(b,u),this},b.Synth.prototype._triggerEnvelopeRelease=function(b){return this.envelope.triggerRelease(b),this},b.Synth.prototype.dispose=function(){return b.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},b.Synth}),u(function(b){return b.AMSynth=function(u){u=this.defaultArg(u,b.AMSynth.defaults),b.Monophonic.call(this,u),this._carrier=new b.Synth,this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(u.envelope),this._modulator=new b.Synth,this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(u.modulation),this.modulationEnvelope=this._modulator.envelope.set(u.modulationEnvelope),this.frequency=new b.Signal(440,b.Type.Frequency),this.detune=new b.Signal(u.detune,b.Type.Cents),this.harmonicity=new b.Multiply(u.harmonicity),this.harmonicity.units=b.Type.Positive,this._modulationScale=new b.AudioToGain,this._modulationNode=new b.Gain,this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])},b.extend(b.AMSynth,b.Monophonic),b.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},b.AMSynth.prototype._triggerEnvelopeAttack=function(b,u){return b=this.toSeconds(b),this.envelope.triggerAttack(b,u),this.modulationEnvelope.triggerAttack(b,u),this},b.AMSynth.prototype._triggerEnvelopeRelease=function(b){return this.envelope.triggerRelease(b),this.modulationEnvelope.triggerRelease(b),this},b.AMSynth.prototype.dispose=function(){return b.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},b.AMSynth}),u(function(b){return b.MonoSynth=function(u){u=this.defaultArg(u,b.MonoSynth.defaults),b.Monophonic.call(this,u),this.oscillator=new b.OmniOscillator(u.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new b.Filter(u.filter),this.filterEnvelope=new b.FrequencyEnvelope(u.filterEnvelope),this.envelope=new b.AmplitudeEnvelope(u.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.oscillator.start(),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},b.extend(b.MonoSynth,b.Monophonic),b.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},b.MonoSynth.prototype._triggerEnvelopeAttack=function(b,u){return this.envelope.triggerAttack(b,u),this.filterEnvelope.triggerAttack(b),this},b.MonoSynth.prototype._triggerEnvelopeRelease=function(b){return this.envelope.triggerRelease(b),this.filterEnvelope.triggerRelease(b),this},b.MonoSynth.prototype.dispose=function(){return b.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},b.MonoSynth}),u(function(b){return b.DuoSynth=function(u){u=this.defaultArg(u,b.DuoSynth.defaults),b.Monophonic.call(this,u),this.voice0=new b.MonoSynth(u.voice0),this.voice0.volume.value=-10,this.voice1=new b.MonoSynth(u.voice1),this.voice1.volume.value=-10,this._vibrato=new b.LFO(u.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new b.Gain(u.vibratoAmount,b.Type.Positive),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new b.Signal(440,b.Type.Frequency),this.harmonicity=new b.Multiply(u.harmonicity),this.harmonicity.units=b.Type.Positive,this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},b.extend(b.DuoSynth,b.Monophonic),b.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},b.DuoSynth.prototype._triggerEnvelopeAttack=function(b,u){return b=this.toSeconds(b),this.voice0.envelope.triggerAttack(b,u),this.voice1.envelope.triggerAttack(b,u),this.voice0.filterEnvelope.triggerAttack(b),this.voice1.filterEnvelope.triggerAttack(b),this},b.DuoSynth.prototype._triggerEnvelopeRelease=function(b){return this.voice0.triggerRelease(b),this.voice1.triggerRelease(b),this},b.DuoSynth.prototype.dispose=function(){return b.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},b.DuoSynth}),u(function(b){return b.FMSynth=function(u){u=this.defaultArg(u,b.FMSynth.defaults),b.Monophonic.call(this,u),this._carrier=new b.Synth(u.carrier),this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(u.envelope),this._modulator=new b.Synth(u.modulator),this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(u.modulation),this.modulationEnvelope=this._modulator.envelope.set(u.modulationEnvelope),this.frequency=new b.Signal(440,b.Type.Frequency),this.detune=new b.Signal(u.detune,b.Type.Cents),this.harmonicity=new b.Multiply(u.harmonicity),this.harmonicity.units=b.Type.Positive,this.modulationIndex=new b.Multiply(u.modulationIndex),this.modulationIndex.units=b.Type.Positive,this._modulationNode=new b.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])},b.extend(b.FMSynth,b.Monophonic),b.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},b.FMSynth.prototype._triggerEnvelopeAttack=function(b,u){return b=this.toSeconds(b),this.envelope.triggerAttack(b,u),this.modulationEnvelope.triggerAttack(b),this},b.FMSynth.prototype._triggerEnvelopeRelease=function(b){return b=this.toSeconds(b),this.envelope.triggerRelease(b),this.modulationEnvelope.triggerRelease(b),this},b.FMSynth.prototype.dispose=function(){return b.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},b.FMSynth}),u(function(b){return b.MembraneSynth=function(u){u=this.defaultArg(u,b.MembraneSynth.defaults),b.Instrument.call(this,u),this.oscillator=new b.OmniOscillator(u.oscillator).start(),this.envelope=new b.AmplitudeEnvelope(u.envelope),this.octaves=u.octaves,this.pitchDecay=u.pitchDecay,this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","envelope"])},b.extend(b.MembraneSynth,b.Instrument),b.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},b.MembraneSynth.prototype.triggerAttack=function(b,u,t){u=this.toSeconds(u),b=this.toFrequency(b);var c=b*this.octaves;return this.oscillator.frequency.setValueAtTime(c,u),this.oscillator.frequency.exponentialRampToValueAtTime(b,u+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(u,t),this},b.MembraneSynth.prototype.triggerRelease=function(b){return this.envelope.triggerRelease(b),this},b.MembraneSynth.prototype.dispose=function(){return b.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},b.MembraneSynth}),u(function(b){var u=[1,1.483,1.932,2.546,2.63,3.897];return b.MetalSynth=function(t){t=this.defaultArg(t,b.MetalSynth.defaults),b.Instrument.call(this,t),this.frequency=new b.Signal(t.frequency,b.Type.Frequency),this._oscillators=[],this._freqMultipliers=[],this._amplitue=new b.Gain(0).connect(this.output),this._highpass=new b.Filter({type:"highpass",Q:-3.0102999566398125}).connect(this._amplitue),this._octaves=t.octaves,this._filterFreqScaler=new b.Scale(t.resonance,7e3),this.envelope=new b.Envelope({attack:t.envelope.attack,attackCurve:"linear",decay:t.envelope.decay,sustain:0,release:t.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitue.gain);for(var c=0;c<u.length;c++){var h=new b.FMOscillator({type:"square",modulationType:"square",harmonicity:t.harmonicity,modulationIndex:t.modulationIndex});h.connect(this._highpass).start(0),this._oscillators[c]=h;var i=new b.Multiply(u[c]);this._freqMultipliers[c]=i,this.frequency.chain(i,h.frequency)}this.octaves=t.octaves},b.extend(b.MetalSynth,b.Instrument),b.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5},b.MetalSynth.prototype.triggerAttack=function(b,u){return b=this.toSeconds(b),u=this.defaultArg(u,1),this.envelope.triggerAttack(b,u),this},b.MetalSynth.prototype.triggerRelease=function(b){return b=this.toSeconds(b),this.envelope.triggerRelease(b),this},b.MetalSynth.prototype.triggerAttackRelease=function(b,u,t){return u=this.toSeconds(u),b=this.toSeconds(b),this.triggerAttack(u,t),this.triggerRelease(u+b),this},Object.defineProperty(b.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(b){for(var u=0;u<this._oscillators.length;u++)this._oscillators[u].modulationIndex.value=b}}),Object.defineProperty(b.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(b){for(var u=0;u<this._oscillators.length;u++)this._oscillators[u].harmonicity.value=b}}),Object.defineProperty(b.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(b){this._filterFreqScaler.min=b,this.octaves=this._octaves}}),Object.defineProperty(b.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(b){this._octaves=b,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,b)}}),b.MetalSynth.prototype.dispose=function(){b.Instrument.prototype.dispose.call(this);for(var u=0;u<this._oscillators.length;u++)this._oscillators[u].dispose(),this._freqMultipliers[u].dispose();this._oscillators=null,this._freqMultipliers=null,this.frequency.dispose(),this.frequency=null,this._filterFreqScaler.dispose(),this._filterFreqScaler=null,this._amplitue.dispose(),this._amplitue=null,this.envelope.dispose(),this.envelope=null,this._highpass.dispose(),this._highpass=null},b.MetalSynth}),u(function(b){return window.AudioBufferSourceNode&&!AudioBufferSourceNode.prototype.start&&(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn,AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),b.BufferSource=function(){var u=this.optionsObject(arguments,["buffer","onended"],b.BufferSource.defaults);this.onended=u.onended,this._startTime=-1,this._stopTime=-1,this._gainNode=this.output=new b.Gain,this._source=this.context.createBufferSource(),this._source.connect(this._gainNode),this.playbackRate=new b.Param(this._source.playbackRate,b.Type.Positive),this.fadeIn=u.fadeIn,this.fadeOut=u.fadeOut,this._gain=1,this._onendedTimeout=-1,this.isUndef(u.buffer)||(this.buffer=u.buffer),this.loop=u.loop},b.extend(b.BufferSource),b.BufferSource.defaults={onended:b.noOp,fadeIn:0,fadeOut:0},Object.defineProperty(b.BufferSource.prototype,"state",{get:function(){var u=this.now();return-1!==this._startTime&&u>=this._startTime&&u<this._stopTime?b.State.Started:b.State.Stopped}}),b.BufferSource.prototype.start=function(b,u,t,c,h){if(-1!==this._startTime)throw new Error("Tone.BufferSource: can only be started once.");return this.buffer&&(b=this.toSeconds(b),u=this.loop?this.defaultArg(u,this.loopStart):this.defaultArg(u,0),u=this.toSeconds(u),b=this.toSeconds(b),this._source.start(b,u),c=this.defaultArg(c,1),this._gain=c,h=this.isUndef(h)?this.toSeconds(this.fadeIn):this.toSeconds(h),h>0?(this._gainNode.gain.setValueAtTime(0,b),this._gainNode.gain.linearRampToValueAtTime(this._gain,b+h)):this._gainNode.gain.setValueAtTime(c,b),this._startTime=b+h,this.isUndef(t)||(t=this.defaultArg(t,this.buffer.duration-u),t=this.toSeconds(t),this.stop(b+t+h,h))),this},b.BufferSource.prototype.stop=function(b,u){return this.buffer&&(b=this.toSeconds(b),u=this.isUndef(u)?this.toSeconds(this.fadeOut):this.toSeconds(u),this._stopTime=b+u,this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),u>0?(this._gainNode.gain.setValueAtTime(this._gain,b),this._gainNode.gain.linearRampToValueAtTime(0,b+u),b+=u):this._gainNode.gain.setValueAtTime(0,b),this.isNumber(this._source.playbackState)&&2!==this._source.playbackState||this._source.stop(b),clearTimeout(this._onendedTimeout),this._onendedTimeout=setTimeout(this._onended.bind(this),1e3*(this._stopTime-this.now()))),this},b.BufferSource.prototype._onended=function(){this.onended(this),this.dispose()},Object.defineProperty(b.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(b){this._source.loopStart=this.toSeconds(b)}}),Object.defineProperty(b.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(b){this._source.loopEnd=this.toSeconds(b)}}),Object.defineProperty(b.BufferSource.prototype,"buffer",{get:function(){return this._source?this._source.buffer:null},set:function(u){u instanceof b.Buffer?this._source.buffer=u.get():this._source.buffer=u}}),Object.defineProperty(b.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(b){this._source.loop=b}}),b.BufferSource.prototype.dispose=function(){return this.onended=null,this._source&&(this._source.disconnect(),this._source=null),this._gainNode&&(this._gainNode.dispose(),this._gainNode=null),this._startTime=-1,this.playbackRate=null,this.output=null,clearTimeout(this._onendedTimeout),this},b.BufferSource}),u(function(b){function u(){for(var u in h)i[u]=(new b.Buffer).fromArray(h[u])}b.Noise=function(){var u=this.optionsObject(arguments,["type"],b.Noise.defaults);b.Source.call(this,u),this._source=null,this._type=u.type,this._playbackRate=u.playbackRate},b.extend(b.Noise,b.Source),b.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(b.Noise.prototype,"type",{get:function(){return this._type},set:function(u){if(this._type!==u){if(!(u in i))throw new TypeError("Tone.Noise: invalid type: "+u);if(this._type=u,this.state===b.State.Started){var t=this.now()+this.blockTime;this._stop(t),this._start(t)}}}}),Object.defineProperty(b.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(b){this._playbackRate=b,this._source&&(this._source.playbackRate.value=b)}}),b.Noise.prototype._start=function(u){var t=i[this._type];this._source=new b.BufferSource(t).connect(this.output),this._source.loop=!0,this._source.playbackRate.value=this._playbackRate,this._source.start(this.toSeconds(u),Math.random()*(t.duration-.001))},b.Noise.prototype._stop=function(b){this._source&&(this._source.stop(this.toSeconds(b)),this._source=null)},b.Noise.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var t=220500,c=2,h={pink:function(){for(var b=[],u=0;c>u;u++){var h=new Float32Array(t);b[u]=h;var i,bb,ub,tb,cb,hb,ib;i=bb=ub=tb=cb=hb=ib=0;for(var bu=0;t>bu;bu++){var uu=2*Math.random()-1;i=.99886*i+.0555179*uu,bb=.99332*bb+.0750759*uu,ub=.969*ub+.153852*uu,tb=.8665*tb+.3104856*uu,cb=.55*cb+.5329522*uu,hb=-.7616*hb-.016898*uu,h[bu]=i+bb+ub+tb+cb+hb+ib+.5362*uu,h[bu]*=.11,ib=.115926*uu}}return b}(),brown:function(){for(var b=[],u=0;c>u;u++){var h=new Float32Array(t);b[u]=h;for(var i=0,bb=0;t>bb;bb++){var ub=2*Math.random()-1;h[bb]=(i+.02*ub)/1.02,i=h[bb],h[bb]*=3.5}}return b}(),white:function(){for(var b=[],u=0;c>u;u++){var h=new Float32Array(t);b[u]=h;for(var i=0;t>i;i++)h[i]=2*Math.random()-1}return b}()},i={};return u(),b.Context.on("init",u),b.Noise}),u(function(b){return b.NoiseSynth=function(u){u=this.defaultArg(u,b.NoiseSynth.defaults),b.Instrument.call(this,u),this.noise=new b.Noise,this.envelope=new b.AmplitudeEnvelope(u.envelope),this.noise.chain(this.envelope,this.output),this.noise.start(),this._readOnly(["noise","envelope"])},b.extend(b.NoiseSynth,b.Instrument),b.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},b.NoiseSynth.prototype.triggerAttack=function(b,u){return this.envelope.triggerAttack(b,u),this},b.NoiseSynth.prototype.triggerRelease=function(b){return this.envelope.triggerRelease(b),this},b.NoiseSynth.prototype.triggerAttackRelease=function(b,u,t){return u=this.toSeconds(u),b=this.toSeconds(b),this.triggerAttack(u,t),this.triggerRelease(u+b),this},b.NoiseSynth.prototype.dispose=function(){return b.Instrument.prototype.dispose.call(this),this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},b.NoiseSynth}),u(function(b){return b.PluckSynth=function(u){u=this.defaultArg(u,b.PluckSynth.defaults),b.Instrument.call(this,u),this._noise=new b.Noise("pink"),this.attackNoise=u.attackNoise,this._lfcf=new b.LowpassCombFilter({resonance:u.resonance,dampening:u.dampening}),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output),this._readOnly(["resonance","dampening"])},b.extend(b.PluckSynth,b.Instrument),b.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.9},b.PluckSynth.prototype.triggerAttack=function(b,u){b=this.toFrequency(b),u=this.toSeconds(u);var t=1/b;return this._lfcf.delayTime.setValueAtTime(t,u),this._noise.start(u),this._noise.stop(u+t*this.attackNoise),this},b.PluckSynth.prototype.dispose=function(){return b.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},b.PluckSynth}),u(function(b){return b.PolySynth=function(){b.Instrument.call(this);var u=this.optionsObject(arguments,["polyphony","voice"],b.PolySynth.defaults);u=this.defaultArg(u,b.Instrument.defaults),u.polyphony=Math.min(b.PolySynth.MAX_POLYPHONY,u.polyphony),this.voices=new Array(u.polyphony),this._triggers=new Array(u.polyphony),this.detune=new b.Signal(u.detune,b.Type.Cents),this._readOnly("detune");for(var t=0;t<u.polyphony;t++){var c=new u.voice(arguments[2],arguments[3]);this.voices[t]=c,c.connect(this.output),c.hasOwnProperty("detune")&&this.detune.connect(c.detune),this._triggers[t]={release:-1,note:null,voice:c}}this.volume.value=u.volume},b.extend(b.PolySynth,b.Instrument),b.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:b.Synth},b.PolySynth.prototype.triggerAttack=function(b,u,t){Array.isArray(b)||(b=[b]),u=this.toSeconds(u);for(var c=0;c<b.length;c++){for(var h=b[c],i=this._triggers[0],bb=0,ub=1;ub<this._triggers.length;ub++)this._triggers[ub].release<i.release&&(i=this._triggers[ub],bb=ub);i.release=1/0,i.note=JSON.stringify(h),i.voice.triggerAttack(h,u,t)}return this},b.PolySynth.prototype.triggerAttackRelease=function(b,u,t,c){if(t=this.toSeconds(t),this.triggerAttack(b,t,c),this.isArray(u)&&this.isArray(b))for(var h=0;h<b.length;h++){var i=u[Math.min(h,u.length-1)];this.triggerRelease(b[h],t+this.toSeconds(i))}else this.triggerRelease(b,t+this.toSeconds(u));return this},b.PolySynth.prototype.triggerRelease=function(b,u){Array.isArray(b)||(b=[b]),u=this.toSeconds(u);for(var t=0;t<b.length;t++)for(var c=JSON.stringify(b[t]),h=0;h<this._triggers.length;h++){var i=this._triggers[h];i.note===c&&i.release>u&&(i.voice.triggerRelease(u),i.release=u)}return this},b.PolySynth.prototype.set=function(b,u,t){for(var c=0;c<this.voices.length;c++)this.voices[c].set(b,u,t);return this},b.PolySynth.prototype.get=function(b){return this.voices[0].get(b)},b.PolySynth.prototype.releaseAll=function(b){b=this.toSeconds(b);for(var u=0;u<this._triggers.length;u++){var t=this._triggers[u];t.release>b&&(t.release=b,t.voice.triggerRelease(b))}return this},b.PolySynth.prototype.dispose=function(){b.Instrument.prototype.dispose.call(this);for(var u=0;u<this.voices.length;u++)this.voices[u].dispose(),this.voices[u]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},b.PolySynth.MAX_POLYPHONY=20,b.PolySynth}),u(function(b){return b.Player=function(u){var t;u instanceof b.Buffer?(u=u.get(),t=b.Player.defaults):t=this.optionsObject(arguments,["url","onload"],b.Player.defaults),b.Source.call(this,t),this._source=null,this.autostart=t.autostart,this._buffer=new b.Buffer({url:t.url,onload:this._onload.bind(this,t.onload),reverse:t.reverse}),u instanceof AudioBuffer&&this._buffer.set(u),this._loop=t.loop,this._loopStart=t.loopStart,
this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.retrigger=t.retrigger},b.extend(b.Player,b.Source),b.Player.defaults={onload:b.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1},b.Player.prototype.load=function(b,u){return this._buffer.load(b,this._onload.bind(this,u))},b.Player.prototype._onload=function(u){u=this.defaultArg(u,b.noOp),u(this),this.autostart&&this.start()},b.Player.prototype._start=function(u,t,c){if(!this._buffer.loaded)throw Error("Tone.Player: tried to start Player before the buffer was loaded");if(t=this._loop?this.defaultArg(t,this._loopStart):this.defaultArg(t,0),t=this.toSeconds(t),c=this.defaultArg(c,Math.max(this._buffer.duration-t,0)),c=this.toSeconds(c),u=this.toSeconds(u),this._source=this.context.createBufferSource(),this._source.buffer=this._buffer.get(),this._loop?(this._source.loop=this._loop,this._source.loopStart=this.toSeconds(this._loopStart),this._source.loopEnd=this.toSeconds(this._loopEnd)):this._synced||this._state.setStateAtTime(b.State.Stopped,u+c),this._source.playbackRate.value=this._playbackRate,this._source.connect(this.output),this._loop){var h=this._source.loopEnd||this._buffer.duration,i=this._source.loopStart,bb=h-i;if(t>h)for(;t>h;)t-=bb;this._source.start(u,t)}else this._source.start(u,t,c);return this},b.Player.prototype._stop=function(b){return this._source&&(this._source.stop(this.toSeconds(b)),this._source=null),this},b.Player.prototype.seek=function(u,t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===b.State.Started&&(u=this.toSeconds(u),this._stop(t),this._start(t,u)),this},b.Player.prototype.setLoopPoints=function(b,u){return this.loopStart=b,this.loopEnd=u,this},Object.defineProperty(b.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(b){this._loopStart=b,this._source&&(this._source.loopStart=this.toSeconds(b))}}),Object.defineProperty(b.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(b){this._loopEnd=b,this._source&&(this._source.loopEnd=this.toSeconds(b))}}),Object.defineProperty(b.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(b){this._buffer.set(b)}}),Object.defineProperty(b.Player.prototype,"loop",{get:function(){return this._loop},set:function(b){this._loop=b,this._source&&(this._source.loop=b)}}),Object.defineProperty(b.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(b){this._playbackRate=b,this._source&&(this._source.playbackRate.value=b)}}),Object.defineProperty(b.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(b){this._buffer.reverse=b}}),b.Player.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer.dispose(),this._buffer=null,this},b.Player}),u(function(b){return b.Sampler=function(){var u=this.optionsObject(arguments,["url","onload"],b.Sampler.defaults);b.Instrument.call(this,u),this.player=new b.Player(u.url,u.onload),this.player.retrigger=!0,this.envelope=new b.AmplitudeEnvelope(u.envelope),this.player.chain(this.envelope,this.output),this._readOnly(["player","envelope"]),this.loop=u.loop,this.reverse=u.reverse},b.extend(b.Sampler,b.Instrument),b.Sampler.defaults={onload:b.noOp,loop:!1,reverse:!1,envelope:{attack:.001,decay:0,sustain:1,release:.1}},b.Sampler.prototype.triggerAttack=function(b,u,t){return u=this.toSeconds(u),b=this.defaultArg(b,0),this.player.playbackRate=this.intervalToFrequencyRatio(b),this.player.start(u),this.envelope.triggerAttack(u,t),this},b.Sampler.prototype.triggerRelease=function(b){return b=this.toSeconds(b),this.envelope.triggerRelease(b),this.player.stop(this.toSeconds(this.envelope.release)+b),this},Object.defineProperty(b.Sampler.prototype,"loop",{get:function(){return this.player.loop},set:function(b){this.player.loop=b}}),Object.defineProperty(b.Sampler.prototype,"reverse",{get:function(){return this.player.reverse},set:function(b){this.player.reverse=b}}),Object.defineProperty(b.Sampler.prototype,"buffer",{get:function(){return this.player.buffer},set:function(b){this.player.buffer=b}}),b.Sampler.prototype.dispose=function(){return b.Instrument.prototype.dispose.call(this),this._writable(["player","envelope"]),this.player.dispose(),this.player=null,this.envelope.dispose(),this.envelope=null,this},b.Sampler}),u(function(b){return b.GainToAudio=function(){this._norm=this.input=this.output=new b.WaveShaper(function(b){return 2*Math.abs(b)-1})},b.extend(b.GainToAudio,b.SignalBase),b.GainToAudio.prototype.dispose=function(){return b.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},b.GainToAudio}),u(function(b){return b.Normalize=function(u,t){this._inputMin=this.defaultArg(u,0),this._inputMax=this.defaultArg(t,1),this._sub=this.input=new b.Add(0),this._div=this.output=new b.Multiply(1),this._sub.connect(this._div),this._setRange()},b.extend(b.Normalize,b.SignalBase),Object.defineProperty(b.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(b){this._inputMin=b,this._setRange()}}),Object.defineProperty(b.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(b){this._inputMax=b,this._setRange()}}),b.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},b.Normalize.prototype.dispose=function(){return b.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},b.Normalize}),u(function(b){return b.MultiPlayer=function(){var u=this.optionsObject(arguments,["urls","onload"],b.MultiPlayer.defaults);u.urls instanceof b.Buffers?this.buffers=u.urls:this.buffers=new b.Buffers(u.urls,u.onload),this._activeSources={},this.fadeIn=u.fadeIn,this.fadeOut=u.fadeOut,this._volume=this.output=new b.Volume(u.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=u.mute},b.extend(b.MultiPlayer,b.Source),b.MultiPlayer.defaults={onload:b.noOp,fadeIn:0,fadeOut:0},b.MultiPlayer.prototype._makeSource=function(u){var t;this.isString(u)||this.isNumber(u)?t=this.buffers.get(u).get():u instanceof b.Buffer?t=u.get():u instanceof AudioBuffer&&(t=u);var c=new b.BufferSource(t).connect(this.output);return this._activeSources.hasOwnProperty(u)||(this._activeSources[u]=[]),this._activeSources[u].push(c),c},b.MultiPlayer.prototype.start=function(b,u,t,c,h,i){u=this.toSeconds(u);var bb=this._makeSource(b);return bb.start(u,t,c,this.defaultArg(i,1),this.fadeIn),c&&bb.stop(u+this.toSeconds(c),this.fadeOut),h=this.defaultArg(h,0),bb.playbackRate.value=this.intervalToFrequencyRatio(h),this},b.MultiPlayer.prototype.startLoop=function(b,u,t,c,h,i,bb){u=this.toSeconds(u);var ub=this._makeSource(b);return ub.loop=!0,ub.loopStart=this.toSeconds(this.defaultArg(c,0)),ub.loopEnd=this.toSeconds(this.defaultArg(h,0)),ub.start(u,t,void 0,this.defaultArg(bb,1),this.fadeIn),i=this.defaultArg(i,0),ub.playbackRate.value=this.intervalToFrequencyRatio(i),this},b.MultiPlayer.prototype.stop=function(b,u){if(!this._activeSources[b]||!this._activeSources[b].length)throw new Error("Tone.MultiPlayer: cannot stop a buffer that hasn't been started or is already stopped");return u=this.toSeconds(u),this._activeSources[b].shift().stop(u,this.fadeOut),this},b.MultiPlayer.prototype.stopAll=function(b){b=this.toSeconds(b);for(var u in this._activeSources)for(var t=this._activeSources[u],c=0;c<t.length;c++)t[c].stop(b);return this},b.MultiPlayer.prototype.add=function(b,u,t){return this.buffers.add(b,u,t),this},Object.defineProperty(b.MultiPlayer.prototype,"state",{get:function(){return this._activeSources.length>0?b.State.Started:b.State.Stopped}}),Object.defineProperty(b.MultiPlayer.prototype,"mute",{get:function(){return this._volume.mute},set:function(b){this._volume.mute=b}}),b.MultiPlayer.prototype.dispose=function(){b.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable("volume"),this.volume=null;for(var u in this._activeSources)this._activeSources[u].forEach(function(b){b.dispose()});return this.buffers.dispose(),this.buffers=null,this._activeSources=null,this},b.MultiPlayer}),u(function(b){return b.GrainPlayer=function(){var u=this.optionsObject(arguments,["url","onload"],b.GrainPlayer.defaults);b.Source.call(this),this.buffer=new b.Buffer(u.url,u.onload),this._player=(new b.MultiPlayer).connect(this.output),this._clock=new b.Clock(this._tick.bind(this),1),this._loopStart=0,this._loopEnd=0,this._playbackRate=u.playbackRate,this._grainSize=u.grainSize,this._overlap=u.overlap,this.detune=u.detune,this.drift=u.drift,this.overlap=u.overlap,this.loop=u.loop,this.playbackRate=u.playbackRate,this.grainSize=u.grainSize,this.loopStart=u.loopStart,this.loopEnd=u.loopEnd,this.reverse=u.reverse},b.extend(b.GrainPlayer,b.Source),b.GrainPlayer.defaults={onload:b.noOp,overlap:.1,grainSize:.2,drift:0,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},b.GrainPlayer.prototype._start=function(b,u,t){u=this.defaultArg(u,0),u=this.toSeconds(u),b=this.toSeconds(b),this._offset=u,this._clock.start(b),this._player.volume.setValueAtTime(0,b),t&&this._stop(b+this.toSeconds(t))},b.GrainPlayer.prototype._stop=function(b){this._clock.stop(b),this._player.volume.cancelScheduledValues(b),this._player.volume.setValueAtTime(-(1/0),b)},b.GrainPlayer.prototype._tick=function(b){var u=this.buffer.duration;this.loop&&this._loopEnd>0&&(u=this._loopEnd);var t=(2*Math.random()-1)*this.drift,c=this._offset-this._overlap+t,h=this.detune/100;c=Math.max(c,0),c=Math.min(c,u);var i=this._player.fadeIn;if(this.loop&&this._offset>u){var bb=this._offset-u;this._player.start(this.buffer,b,c,bb+this._overlap,h),c=this._offset%u,this._offset=this._loopStart,this._player.fadeIn=0,this._player.start(this.buffer,b+bb,this._offset,c+this._overlap,h)}else this._offset>u?this.stop(b):(0===c&&(this._player.fadeIn=0),this._player.start(this.buffer,b,c,this.grainSize+this._overlap,h));this._player.fadeIn=i;var ub=this._clock._nextTick-b;this._offset+=ub*this._playbackRate},b.GrainPlayer.prototype.scrub=function(b,u){return this._offset=this.toSeconds(b),this._tick(this.toSeconds(u)),this},Object.defineProperty(b.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(b){this._playbackRate=b,this.grainSize=this._grainSize}}),Object.defineProperty(b.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(b){this._loopStart=this.toSeconds(b)}}),Object.defineProperty(b.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(b){this._loopEnd=this.toSeconds(b)}}),Object.defineProperty(b.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(b){this.buffer.reverse=b}}),Object.defineProperty(b.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(b){this._grainSize=this.toSeconds(b),this._clock.frequency.value=this._playbackRate/this._grainSize}}),Object.defineProperty(b.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(b){b=this.toSeconds(b),this._overlap=b,this._overlap<0?(this._player.fadeIn=.01,this._player.fadeOut=.01):(this._player.fadeIn=b,this._player.fadeOut=b)}}),b.GrainPlayer.prototype.dispose=function(){return b.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._player.dispose(),this._player=null,this._clock.dispose(),this._clock=null,this},b.GrainPlayer}),u(function(b){return b.UserMedia=function(){var u=this.optionsObject(arguments,["volume"],b.UserMedia.defaults);this._mediaStream=null,this._stream=null,this._device=null,this._volume=this.output=new b.Volume(u.volume),this.volume=this._volume.volume,this._readOnly("volume"),this.mute=u.mute},b.extend(b.UserMedia),b.UserMedia.defaults={volume:0,mute:!1},b.UserMedia.prototype.open=function(b){return b=this.defaultArg(b,"default"),this.enumerateDevices().then(function(u){var t;if(this.isNumber(b)?t=u[b]:(t=u.find(function(u){return u.label===b||u.deviceId===b}),t||(t=u[0])),!t)throw new Error("Tone.UserMedia: no matching audio inputs.");this._device=t;var c={audio:{deviceId:t.deviceId,echoCancellation:!1,sampleRate:this.context.sampleRate}};return navigator.mediaDevices.getUserMedia(c).then(function(b){return this._stream||(this._stream=b,this._mediaStream=this.context.createMediaStreamSource(b),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},b.UserMedia.prototype.close=function(){return this._stream&&(this._stream.getAudioTracks().forEach(function(b){b.stop()}),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},b.UserMedia.prototype.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then(function(b){return b.filter(function(b){return"audioinput"===b.kind})})},Object.defineProperty(b.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?b.State.Started:b.State.Stopped}}),Object.defineProperty(b.UserMedia.prototype,"deviceId",{get:function(){return this._device?this._device.deviceId:void 0}}),Object.defineProperty(b.UserMedia.prototype,"groupId",{get:function(){return this._device?this._device.groupId:void 0}}),Object.defineProperty(b.UserMedia.prototype,"label",{get:function(){return this._device?this._device.label:void 0}}),Object.defineProperty(b.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(b){this._volume.mute=b}}),b.UserMedia.prototype.dispose=function(){return b.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(b.UserMedia,"supported",{get:function(){return!b.prototype.isUndef(navigator.mediaDevices)&&b.prototype.isFunction(navigator.mediaDevices.getUserMedia)}}),b.UserMedia}),t})},{}],2:[function(b,u,t){"use strict";function c(b){var u=ub(b)*bb(2*h*ub(b)),t=ub(b)*i(2*h*ub(b));return{x:u,y:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.bion=c;var h=Math.PI,i=Math.sin,bb=Math.cos,ub=Math.log2},{}],3:[function(b,u,t){"use strict";function c(b){return b&&b.__esModule?b:{"default":b}}function h(b,u){if(!(b instanceof u))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function b(b,u){for(var t=0;t<u.length;t++){var c=u[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(b,c.key,c)}}return function(u,t,c){return t&&b(u.prototype,t),c&&b(u,c),u}}(),bb=b("./Router"),ub=c(bb),tb=function(){function b(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,b),console.log("Hello, world!"),this.initialize(),console.log("Thanks, world!")}return i(b,[{key:"initialize",value:function(){var b=this;$(function(){b.router=new ub["default"]})}}]),b}();t["default"]=tb},{"./Router":4}],4:[function(b,u,t){"use strict";function c(b){return b&&b.__esModule?b:{"default":b}}function h(b,u){if(!(b instanceof u))throw new TypeError("Cannot call a class as a function")}function i(b,u){document.querySelector('body[data-page-id="'+b+'"]')&&u()}Object.defineProperty(t,"__esModule",{value:!0});var bb=function(){function b(b,u){for(var t=0;t<u.length;t++){var c=u[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(b,c.key,c)}}return function(u,t,c){return t&&b(u.prototype,t),c&&b(u,c),u}}(),ub=b("./ns"),tb=c(ub),cb=b("../page/common"),hb=c(cb),ib=b("../page/index"),bu=c(ib),uu=function(){function b(){h(this,b),this.initialize()}return bb(b,[{key:"initialize",value:function(){tb["default"].page=tb["default"].page||{},(0,hb["default"])(),i("index",bu["default"])}}]),b}();t["default"]=uu},{"../page/common":6,"../page/index":7,"./ns":5}],5:[function(b,u,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),window.App=window.App||{};var c=window.App;t["default"]=c},{}],6:[function(b,u,t){"use strict";function c(b){return b&&b.__esModule?b:{"default":b}}function h(){var b=$("html");bb["default"].isSp=!1,bb["default"].isPc=!1,bb["default"].isTab=!1,b.hasClass("is-sp")&&(bb["default"].isSp=!0),b.hasClass("is-pc")&&(bb["default"].isPc=!0),b.hasClass("is-tab")&&(bb["default"].isTab=!0)}Object.defineProperty(t,"__esModule",{value:!0});var i=b("../module/ns"),bb=c(i);t["default"]=function(){console.log("page common"),h()}},{"../module/ns":5}],7:[function(b,u,t){"use strict";function c(b){return b&&b.__esModule?b:{"default":b}}Object.defineProperty(t,"__esModule",{value:!0});var h=b("tone"),i=c(h),bb=b("../module/ns"),ub=(c(bb),b("../module/BMath"));t["default"]=function(){var b=32,u=new Array(b).fill(null).map(function(){return new i["default"].Synth({oscillator:{type:"sine"},envelope:{attack:.01,decay:.8,sustain:.8,release:.2}}).toMaster()}),t=document.querySelector(".bion-container"),c=$(t),h=$('<div class="coord"></div>');c.append(h);for(var bb=1;b>=bb;bb++){var tb=(0,ub.bion)(bb),cb=$('<div class="bion-elm" data-index="'+(bb-1)+'" data-freq="'+80*bb+'"></div>'),hb=$('<div class="bg"></div>'),ib=$('<span class="number">');ib.text(bb),cb.append(hb),cb.append(ib),h.append(cb),cb.css({left:50*tb.x,top:50*-tb.y})}c.on("click",".bion-elm",function(b){var t=$(b.target).closest(".bion-elm"),c=parseInt(t.attr("data-freq")),h=parseInt(t.attr("data-index")),i=!!t.attr("data-is-continue"),bb=u[h];i?(bb.triggerRelease(),t.removeAttr("data-is-continue")):(bb.triggerAttack(c),t.attr("data-is-continue",!0))}),c.on("mouseover touchstart",".bion-elm",function(b){var t=$(b.target).closest(".bion-elm"),c=parseInt(t.attr("data-freq")),h=parseInt(t.attr("data-index")),i=!!t.attr("data-is-continue");if(!i){var bb=u[h];bb.triggerAttackRelease(c,.1)}})}},{"../module/BMath":2,"../module/ns":5,tone:1}],8:[function(b,u,t){"use strict";function c(b){return b&&b.__esModule?b:{"default":b}}var h=b("./module/ns"),i=c(h),bb=b("./module/Main"),ub=c(bb);i["default"].main=new ub["default"]},{"./module/Main":3,"./module/ns":5}]},{},[8]);